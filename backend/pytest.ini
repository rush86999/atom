[pytest]
# Pytest Configuration for Atom Testing Framework
# Supports property-based, fuzzy, mutation, and chaos testing

# Test Discovery
pythonpath = .
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Markers
markers =
    # Test Type Markers
    unit: Unit tests (fast, isolated)
    integration: Integration tests (slower, requires dependencies)
    property: Property-based tests using Hypothesis
    invariant: Invariant tests (critical system invariants)
    contract: Interface contract tests
    slow: Slow tests (> 1 second)
    fuzzy: Fuzzy tests using Atheris or python-fuzz
    mutation: Mutation testing validation
    chaos: Chaos engineering tests

    # Domain Markers
    financial: Financial operations tests
    security: Security validation tests
    api: API contract tests
    database: Database model tests
    workflow: Workflow execution tests
    episode: Episode management tests
    agent: Agent coordination tests
    governance: Agent governance tests

    # Priority Markers
    P0: Critical priority (security, financial)
    P1: High priority (core business logic)
    P2: Medium priority (API, tools)
    P3: Low priority (nice-to-have)

    # Governance Markers
    student: Tests for STUDENT maturity agents
    intern: Tests for INTERN maturity agents
    supervised: Tests for SUPERVISED maturity agents
    autonomous: Tests for AUTONOMOUS maturity agents

# Reporting
addopts =
    -v --strict-markers --tb=short
    # Parallel execution support (group tests by scope)
    --dist loadscope
    # Coverage reporting
    --cov=core
    --cov=api
    --cov=tools
    --cov-report=html:tests/coverage_reports/html
    --cov-report=term-missing:skip-covered
    --cov-report=json:tests/coverage_reports/metrics/coverage.json
    # Coverage thresholds
    --cov-fail-under=80
    --cov-branch
    # Show local variables in tracebacks
    --showlocals

# Async support
asyncio_mode = auto

# Hypothesis Settings
hypothesis_strategy = conservative
hypothesis_max_examples = 200
hypothesis_derandomize = false

# Ignore Patterns
ignore =
    # Ignore development/debug scripts
    tests/investigate_*.py
    tests/verify_*.py
    tests/quick_*.py
    tests/final_*.py
    tests/simple_*.py
    # Ignore mock test files
    tests/mock_*.py

# Logging
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S
