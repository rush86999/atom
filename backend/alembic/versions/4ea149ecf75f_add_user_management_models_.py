"""Add user management models (EmailVerificationToken, Tenant, AdminRole, AdminUser, MeetingAttendanceStatus, FinancialAccount, NetWorthSnapshot) and update User model

Revision ID: 4ea149ecf75f
Revises: 61484a704b1b
Create Date: 2026-02-02 07:51:40.561320

"""
from typing import Sequence, Union
from alembic import op
import sqlalchemy as sa

# revision identifiers, used by Alembic.
revision: str = '4ea149ecf75f'
down_revision: Union[str, Sequence[str], None] = '61484a704b1b'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('admin_roles',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('permissions', sa.JSON(), nullable=True),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('name')
    )
    op.create_table('agent_jobs',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('agent_id', sa.String(), nullable=False),
    sa.Column('status', sa.String(), nullable=True),
    sa.Column('start_time', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('end_time', sa.DateTime(timezone=True), nullable=True),
    sa.Column('logs', sa.Text(), nullable=True),
    sa.Column('result_summary', sa.Text(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('canvas_audit',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('workspace_id', sa.String(), nullable=True),
    sa.Column('agent_id', sa.String(), nullable=True),
    sa.Column('agent_execution_id', sa.String(), nullable=True),
    sa.Column('user_id', sa.String(), nullable=False),
    sa.Column('canvas_id', sa.String(), nullable=True),
    sa.Column('session_id', sa.String(), nullable=True),
    sa.Column('component_type', sa.String(), nullable=False),
    sa.Column('component_name', sa.String(), nullable=True),
    sa.Column('action', sa.String(), nullable=False),
    sa.Column('audit_metadata', sa.JSON(), nullable=True),
    sa.Column('governance_check_passed', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_canvas_audit_agent_execution_id'), 'canvas_audit', ['agent_execution_id'], unique=False)
    op.create_index(op.f('ix_canvas_audit_agent_id'), 'canvas_audit', ['agent_id'], unique=False)
    op.create_index(op.f('ix_canvas_audit_canvas_id'), 'canvas_audit', ['canvas_id'], unique=False)
    op.create_index(op.f('ix_canvas_audit_created_at'), 'canvas_audit', ['created_at'], unique=False)
    op.create_index(op.f('ix_canvas_audit_session_id'), 'canvas_audit', ['session_id'], unique=False)
    op.create_index(op.f('ix_canvas_audit_user_id'), 'canvas_audit', ['user_id'], unique=False)
    op.create_index(op.f('ix_canvas_audit_workspace_id'), 'canvas_audit', ['workspace_id'], unique=False)
    op.create_table('canvas_collaboration_sessions',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('canvas_id', sa.String(), nullable=False),
    sa.Column('session_id', sa.String(), nullable=False),
    sa.Column('user_id', sa.String(), nullable=False),
    sa.Column('status', sa.String(), nullable=True),
    sa.Column('collaboration_mode', sa.String(), nullable=True),
    sa.Column('max_agents', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('completed_at', sa.DateTime(timezone=True), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_canvas_collaboration_sessions_canvas_id'), 'canvas_collaboration_sessions', ['canvas_id'], unique=False)
    op.create_index(op.f('ix_canvas_collaboration_sessions_session_id'), 'canvas_collaboration_sessions', ['session_id'], unique=False)
    op.create_index(op.f('ix_canvas_collaboration_sessions_user_id'), 'canvas_collaboration_sessions', ['user_id'], unique=False)
    op.create_table('chat_messages',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('conversation_id', sa.String(), nullable=False),
    sa.Column('workspace_id', sa.String(), nullable=False),
    sa.Column('role', sa.String(), nullable=False),
    sa.Column('content', sa.Text(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_chat_messages_conversation_id'), 'chat_messages', ['conversation_id'], unique=False)
    op.create_index(op.f('ix_chat_messages_workspace_id'), 'chat_messages', ['workspace_id'], unique=False)
    op.create_table('chat_sessions',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('user_id', sa.String(), nullable=False),
    sa.Column('title', sa.String(), nullable=True),
    sa.Column('metadata_json', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('message_count', sa.Integer(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_chat_sessions_user_id'), 'chat_sessions', ['user_id'], unique=False)
    op.create_table('device_audit',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('workspace_id', sa.String(), nullable=True),
    sa.Column('agent_id', sa.String(), nullable=True),
    sa.Column('agent_execution_id', sa.String(), nullable=True),
    sa.Column('user_id', sa.String(), nullable=False),
    sa.Column('device_node_id', sa.String(), nullable=False),
    sa.Column('session_id', sa.String(), nullable=True),
    sa.Column('action_type', sa.String(), nullable=False),
    sa.Column('action_params', sa.JSON(), nullable=True),
    sa.Column('success', sa.Boolean(), nullable=False),
    sa.Column('result_summary', sa.Text(), nullable=True),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('result_data', sa.JSON(), nullable=True),
    sa.Column('file_path', sa.Text(), nullable=True),
    sa.Column('duration_ms', sa.Integer(), nullable=True),
    sa.Column('governance_check_passed', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_device_audit_agent_execution_id'), 'device_audit', ['agent_execution_id'], unique=False)
    op.create_index(op.f('ix_device_audit_agent_id'), 'device_audit', ['agent_id'], unique=False)
    op.create_index(op.f('ix_device_audit_created_at'), 'device_audit', ['created_at'], unique=False)
    op.create_index(op.f('ix_device_audit_device_node_id'), 'device_audit', ['device_node_id'], unique=False)
    op.create_index(op.f('ix_device_audit_session_id'), 'device_audit', ['session_id'], unique=False)
    op.create_index(op.f('ix_device_audit_user_id'), 'device_audit', ['user_id'], unique=False)
    op.create_index(op.f('ix_device_audit_workspace_id'), 'device_audit', ['workspace_id'], unique=False)
    op.create_table('integration_catalog',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('category', sa.String(), nullable=False),
    sa.Column('icon', sa.String(), nullable=True),
    sa.Column('color', sa.String(), nullable=True),
    sa.Column('auth_type', sa.String(), nullable=True),
    sa.Column('native_id', sa.String(), nullable=True),
    sa.Column('triggers', sa.JSON(), nullable=True),
    sa.Column('actions', sa.JSON(), nullable=True),
    sa.Column('popular', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('tenants',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('subdomain', sa.String(), nullable=False),
    sa.Column('plan_type', sa.String(), nullable=True),
    sa.Column('status', sa.String(), nullable=True),
    sa.Column('settings', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_tenants_subdomain'), 'tenants', ['subdomain'], unique=True)
    op.create_table('admin_users',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('email', sa.String(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('password_hash', sa.String(), nullable=False),
    sa.Column('role_id', sa.String(), nullable=False),
    sa.Column('status', sa.String(), nullable=True),
    sa.Column('last_login', sa.DateTime(timezone=True), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['role_id'], ['admin_roles.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_admin_users_email'), 'admin_users', ['email'], unique=True)
    op.create_index('ix_admin_users_status', 'admin_users', ['status'], unique=False)
    op.create_table('business_product_services',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('workspace_id', sa.String(), nullable=False),
    sa.Column('external_id', sa.String(), nullable=True),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('type', sa.String(), nullable=True),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('base_price', sa.Float(), nullable=True),
    sa.Column('unit_cost', sa.Float(), nullable=True),
    sa.Column('currency', sa.String(), nullable=True),
    sa.Column('stock_quantity', sa.Integer(), nullable=True),
    sa.Column('metadata_json', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['workspace_id'], ['workspaces.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_business_product_services_external_id'), 'business_product_services', ['external_id'], unique=False)
    op.create_table('business_rules',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('workspace_id', sa.String(), nullable=False),
    sa.Column('description', sa.String(), nullable=False),
    sa.Column('rule_type', sa.String(), nullable=False),
    sa.Column('formula', sa.Text(), nullable=True),
    sa.Column('value', sa.Float(), nullable=True),
    sa.Column('applies_to', sa.String(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('metadata_json', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['workspace_id'], ['workspaces.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('device_nodes',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('workspace_id', sa.String(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('device_id', sa.String(), nullable=False),
    sa.Column('node_type', sa.String(), nullable=False),
    sa.Column('status', sa.String(), nullable=True),
    sa.Column('last_seen', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('capabilities', sa.JSON(), nullable=True),
    sa.Column('capabilities_detailed', sa.JSON(), nullable=True),
    sa.Column('platform', sa.String(), nullable=True),
    sa.Column('platform_version', sa.String(), nullable=True),
    sa.Column('architecture', sa.String(), nullable=True),
    sa.Column('tauri_version', sa.String(), nullable=True),
    sa.Column('app_version', sa.String(), nullable=True),
    sa.Column('version', sa.String(), nullable=True),
    sa.Column('hardware_info', sa.JSON(), nullable=True),
    sa.Column('metadata_json', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('user_id', sa.String(), nullable=False),
    sa.ForeignKeyConstraint(['workspace_id'], ['workspaces.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_device_nodes_device_id'), 'device_nodes', ['device_id'], unique=False)
    op.create_index(op.f('ix_device_nodes_user_id'), 'device_nodes', ['user_id'], unique=False)
    op.create_index(op.f('ix_device_nodes_workspace_id'), 'device_nodes', ['workspace_id'], unique=False)
    op.create_table('graph_communities',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('workspace_id', sa.String(), nullable=False),
    sa.Column('name', sa.String(), nullable=True),
    sa.Column('summary', sa.Text(), nullable=True),
    sa.Column('keywords', sa.JSON(), nullable=True),
    sa.Column('level', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['workspace_id'], ['workspaces.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_graph_communities_workspace_id'), 'graph_communities', ['workspace_id'], unique=False)
    op.create_table('graph_nodes',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('workspace_id', sa.String(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('type', sa.String(), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('properties', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['workspace_id'], ['workspaces.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_graph_nodes_name'), 'graph_nodes', ['name'], unique=False)
    op.create_index(op.f('ix_graph_nodes_workspace_id'), 'graph_nodes', ['workspace_id'], unique=False)
    op.create_table('ingested_documents',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('workspace_id', sa.String(), nullable=False),
    sa.Column('tenant_id', sa.String(), nullable=True),
    sa.Column('file_name', sa.String(), nullable=False),
    sa.Column('file_path', sa.String(), nullable=False),
    sa.Column('file_type', sa.String(), nullable=False),
    sa.Column('integration_id', sa.String(), nullable=False),
    sa.Column('file_size_bytes', sa.Integer(), nullable=True),
    sa.Column('content_preview', sa.Text(), nullable=True),
    sa.Column('external_id', sa.String(), nullable=False),
    sa.Column('external_modified_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('ingested_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['workspace_id'], ['workspaces.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_ingested_documents_external_id'), 'ingested_documents', ['external_id'], unique=False)
    op.create_index(op.f('ix_ingested_documents_integration_id'), 'ingested_documents', ['integration_id'], unique=False)
    op.create_index(op.f('ix_ingested_documents_tenant_id'), 'ingested_documents', ['tenant_id'], unique=False)
    op.create_index(op.f('ix_ingested_documents_workspace_id'), 'ingested_documents', ['workspace_id'], unique=False)
    op.create_table('ingestion_settings',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('workspace_id', sa.String(), nullable=False),
    sa.Column('integration_id', sa.String(), nullable=False),
    sa.Column('enabled', sa.Boolean(), nullable=True),
    sa.Column('auto_sync_new_files', sa.Boolean(), nullable=True),
    sa.Column('file_types', sa.JSON(), nullable=True),
    sa.Column('sync_folders', sa.JSON(), nullable=True),
    sa.Column('exclude_folders', sa.JSON(), nullable=True),
    sa.Column('max_file_size_mb', sa.Integer(), nullable=True),
    sa.Column('sync_frequency_minutes', sa.Integer(), nullable=True),
    sa.Column('last_sync', sa.DateTime(timezone=True), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['workspace_id'], ['workspaces.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_ingestion_settings_integration_id'), 'ingestion_settings', ['integration_id'], unique=False)
    op.create_index(op.f('ix_ingestion_settings_workspace_id'), 'ingestion_settings', ['workspace_id'], unique=False)
    op.create_table('integration_metrics',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('workspace_id', sa.String(), nullable=False),
    sa.Column('integration_type', sa.String(), nullable=False),
    sa.Column('metric_key', sa.String(), nullable=False),
    sa.Column('value', sa.JSON(), nullable=False),
    sa.Column('unit', sa.String(), nullable=True),
    sa.Column('timeframe', sa.String(), nullable=True),
    sa.Column('last_synced_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['workspace_id'], ['workspaces.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('agent_registry',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('category', sa.String(), nullable=False),
    sa.Column('module_path', sa.String(), nullable=False),
    sa.Column('class_name', sa.String(), nullable=False),
    sa.Column('user_id', sa.String(), nullable=True),
    sa.Column('status', sa.String(), nullable=True),
    sa.Column('confidence_score', sa.Float(), nullable=True),
    sa.Column('required_role_for_autonomy', sa.String(), nullable=True),
    sa.Column('version', sa.String(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('configuration', sa.JSON(), nullable=True),
    sa.Column('schedule_config', sa.JSON(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_agent_registry_user_id'), 'agent_registry', ['user_id'], unique=False)
    op.create_table('chat_processes',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('user_id', sa.String(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('current_step', sa.Integer(), nullable=True),
    sa.Column('total_steps', sa.Integer(), nullable=False),
    sa.Column('steps', sa.Text(), nullable=True),
    sa.Column('context', sa.Text(), nullable=True),
    sa.Column('inputs', sa.Text(), nullable=True),
    sa.Column('outputs', sa.Text(), nullable=True),
    sa.Column('status', sa.String(), nullable=True),
    sa.Column('missing_parameters', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('visibility', sa.String(), nullable=False),
    sa.Column('owner_id', sa.String(), nullable=True),
    sa.Column('team_id', sa.String(), nullable=True),
    sa.ForeignKeyConstraint(['owner_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['team_id'], ['teams.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_chat_processes_owner_id'), 'chat_processes', ['owner_id'], unique=False)
    op.create_index(op.f('ix_chat_processes_team_id'), 'chat_processes', ['team_id'], unique=False)
    op.create_index(op.f('ix_chat_processes_visibility'), 'chat_processes', ['visibility'], unique=False)
    op.create_table('collaboration_comments',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('workflow_id', sa.String(), nullable=False),
    sa.Column('author_id', sa.String(), nullable=False),
    sa.Column('content', sa.Text(), nullable=False),
    sa.Column('parent_comment_id', sa.String(), nullable=True),
    sa.Column('context_type', sa.String(), nullable=True),
    sa.Column('context_id', sa.String(), nullable=True),
    sa.Column('is_resolved', sa.Boolean(), nullable=True),
    sa.Column('resolved_by', sa.String(), nullable=True),
    sa.Column('resolved_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['author_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['parent_comment_id'], ['collaboration_comments.id'], ),
    sa.ForeignKeyConstraint(['resolved_by'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_collaboration_comments_author_id'), 'collaboration_comments', ['author_id'], unique=False)
    op.create_index('ix_collaboration_comments_context', 'collaboration_comments', ['context_type', 'context_id'], unique=False)
    op.create_index(op.f('ix_collaboration_comments_created_at'), 'collaboration_comments', ['created_at'], unique=False)
    op.create_index(op.f('ix_collaboration_comments_is_resolved'), 'collaboration_comments', ['is_resolved'], unique=False)
    op.create_index(op.f('ix_collaboration_comments_parent_comment_id'), 'collaboration_comments', ['parent_comment_id'], unique=False)
    op.create_index('ix_collaboration_comments_resolved', 'collaboration_comments', ['is_resolved'], unique=False)
    op.create_index('ix_collaboration_comments_thread', 'collaboration_comments', ['parent_comment_id'], unique=False)
    op.create_index('ix_collaboration_comments_workflow', 'collaboration_comments', ['workflow_id'], unique=False)
    op.create_index(op.f('ix_collaboration_comments_workflow_id'), 'collaboration_comments', ['workflow_id'], unique=False)
    op.create_table('community_memberships',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('community_id', sa.String(), nullable=False),
    sa.Column('node_id', sa.String(), nullable=False),
    sa.Column('rank', sa.Integer(), nullable=True),
    sa.ForeignKeyConstraint(['community_id'], ['graph_communities.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['node_id'], ['graph_nodes.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('custom_components',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('workspace_id', sa.String(), nullable=True),
    sa.Column('user_id', sa.String(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('slug', sa.String(), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('category', sa.String(), nullable=True),
    sa.Column('html_content', sa.Text(), nullable=True),
    sa.Column('css_content', sa.Text(), nullable=True),
    sa.Column('js_content', sa.Text(), nullable=True),
    sa.Column('props_schema', sa.JSON(), nullable=True),
    sa.Column('default_props', sa.JSON(), nullable=True),
    sa.Column('dependencies', sa.JSON(), nullable=True),
    sa.Column('requires_governance', sa.Boolean(), nullable=True),
    sa.Column('min_maturity_level', sa.String(), nullable=True),
    sa.Column('is_public', sa.Boolean(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('usage_count', sa.Integer(), nullable=True),
    sa.Column('last_used_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('current_version', sa.Integer(), nullable=True),
    sa.Column('parent_component_id', sa.String(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['parent_component_id'], ['custom_components.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_custom_components_category', 'custom_components', ['category'], unique=False)
    op.create_index(op.f('ix_custom_components_created_at'), 'custom_components', ['created_at'], unique=False)
    op.create_index('ix_custom_components_is_active', 'custom_components', ['is_active'], unique=False)
    op.create_index('ix_custom_components_is_public', 'custom_components', ['is_public'], unique=False)
    op.create_index(op.f('ix_custom_components_slug'), 'custom_components', ['slug'], unique=True)
    op.create_index(op.f('ix_custom_components_user_id'), 'custom_components', ['user_id'], unique=False)
    op.create_index(op.f('ix_custom_components_workspace_id'), 'custom_components', ['workspace_id'], unique=False)
    op.create_index('ix_custom_components_workspace_user', 'custom_components', ['workspace_id', 'user_id'], unique=False)
    op.create_table('email_verification_tokens',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('user_id', sa.String(), nullable=False),
    sa.Column('token', sa.String(), nullable=False),
    sa.Column('expires_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_email_verification_tokens_token'), 'email_verification_tokens', ['token'], unique=False)
    op.create_index(op.f('ix_email_verification_tokens_user_id'), 'email_verification_tokens', ['user_id'], unique=False)
    op.create_index('ix_email_verification_user_token', 'email_verification_tokens', ['user_id', 'token'], unique=False)
    op.create_table('financial_accounts',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('user_id', sa.String(), nullable=False),
    sa.Column('account_type', sa.String(), nullable=False),
    sa.Column('provider', sa.String(), nullable=True),
    sa.Column('provider_account_id', sa.String(), nullable=True),
    sa.Column('balance', sa.Float(), nullable=True),
    sa.Column('currency', sa.String(), nullable=True),
    sa.Column('name', sa.String(), nullable=True),
    sa.Column('account_metadata', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_financial_accounts_user_id'), 'financial_accounts', ['user_id'], unique=False)
    op.create_index('ix_financial_accounts_user_type', 'financial_accounts', ['user_id', 'account_type'], unique=False)
    op.create_table('graph_edges',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('workspace_id', sa.String(), nullable=False),
    sa.Column('source_node_id', sa.String(), nullable=False),
    sa.Column('target_node_id', sa.String(), nullable=False),
    sa.Column('relationship_type', sa.String(), nullable=False),
    sa.Column('weight', sa.Float(), nullable=True),
    sa.Column('properties', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['source_node_id'], ['graph_nodes.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['target_node_id'], ['graph_nodes.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['workspace_id'], ['workspaces.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_graph_edges_source_node_id'), 'graph_edges', ['source_node_id'], unique=False)
    op.create_index(op.f('ix_graph_edges_target_node_id'), 'graph_edges', ['target_node_id'], unique=False)
    op.create_index(op.f('ix_graph_edges_workspace_id'), 'graph_edges', ['workspace_id'], unique=False)
    op.create_table('hitl_actions',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('workspace_id', sa.String(), nullable=False),
    sa.Column('agent_id', sa.String(), nullable=True),
    sa.Column('action_type', sa.String(), nullable=False),
    sa.Column('platform', sa.String(), nullable=False),
    sa.Column('params', sa.JSON(), nullable=False),
    sa.Column('status', sa.String(), nullable=True),
    sa.Column('reason', sa.String(), nullable=True),
    sa.Column('user_id', sa.String(), nullable=True),
    sa.Column('confidence_score', sa.Float(), nullable=True),
    sa.Column('user_feedback', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('reviewed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('reviewed_by', sa.String(), nullable=True),
    sa.ForeignKeyConstraint(['reviewed_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['workspace_id'], ['workspaces.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_hitl_actions_user_id'), 'hitl_actions', ['user_id'], unique=False)
    op.create_table('meeting_attendance_status',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('task_id', sa.String(), nullable=False),
    sa.Column('user_id', sa.String(), nullable=False),
    sa.Column('platform', sa.String(), nullable=True),
    sa.Column('meeting_identifier', sa.String(), nullable=True),
    sa.Column('status_timestamp', sa.DateTime(timezone=True), nullable=False),
    sa.Column('current_status_message', sa.Text(), nullable=True),
    sa.Column('final_notion_page_url', sa.String(), nullable=True),
    sa.Column('error_details', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_meeting_attendance_status_task_id'), 'meeting_attendance_status', ['task_id'], unique=False)
    op.create_index(op.f('ix_meeting_attendance_status_user_id'), 'meeting_attendance_status', ['user_id'], unique=False)
    op.create_index('ix_meeting_attendance_task', 'meeting_attendance_status', ['task_id', 'user_id'], unique=False)
    op.create_index('ix_meeting_attendance_timestamp', 'meeting_attendance_status', ['status_timestamp'], unique=False)
    op.create_table('net_worth_snapshots',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('user_id', sa.String(), nullable=False),
    sa.Column('snapshot_date', sa.DateTime(timezone=True), nullable=False),
    sa.Column('net_worth', sa.Float(), nullable=False),
    sa.Column('assets', sa.Float(), nullable=True),
    sa.Column('liabilities', sa.Float(), nullable=True),
    sa.Column('breakdown', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_net_worth_snapshots_snapshot_date'), 'net_worth_snapshots', ['snapshot_date'], unique=False)
    op.create_index(op.f('ix_net_worth_snapshots_user_id'), 'net_worth_snapshots', ['user_id'], unique=False)
    op.create_index('ix_net_worth_user_date', 'net_worth_snapshots', ['user_id', 'snapshot_date'], unique=False)
    op.create_table('password_reset_tokens',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('user_id', sa.String(), nullable=False),
    sa.Column('token_hash', sa.String(), nullable=False),
    sa.Column('expires_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('is_used', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_password_reset_tokens_token_hash'), 'password_reset_tokens', ['token_hash'], unique=False)
    op.create_table('team_messages',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('team_id', sa.String(), nullable=False),
    sa.Column('user_id', sa.String(), nullable=False),
    sa.Column('content', sa.Text(), nullable=False),
    sa.Column('context_type', sa.String(), nullable=True),
    sa.Column('context_id', sa.String(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['team_id'], ['teams.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('user_connections',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('user_id', sa.String(), nullable=False),
    sa.Column('workspace_id', sa.String(), nullable=True),
    sa.Column('integration_id', sa.String(), nullable=False),
    sa.Column('connection_name', sa.String(), nullable=False),
    sa.Column('credentials', sa.JSON(), nullable=False),
    sa.Column('status', sa.String(), nullable=True),
    sa.Column('last_used', sa.DateTime(timezone=True), nullable=True),
    sa.Column('expires_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['workspace_id'], ['workspaces.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_user_connections_integration_id'), 'user_connections', ['integration_id'], unique=False)
    op.create_index(op.f('ix_user_connections_user_id'), 'user_connections', ['user_id'], unique=False)
    op.create_index(op.f('ix_user_connections_workspace_id'), 'user_connections', ['workspace_id'], unique=False)
    op.create_table('user_sessions',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('user_id', sa.String(), nullable=False),
    sa.Column('session_token', sa.String(), nullable=False),
    sa.Column('user_agent', sa.String(), nullable=True),
    sa.Column('ip_address', sa.String(), nullable=True),
    sa.Column('device_type', sa.String(), nullable=True),
    sa.Column('browser', sa.String(), nullable=True),
    sa.Column('os', sa.String(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('last_active_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('expires_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('session_token')
    )
    op.create_table('user_workspaces',
    sa.Column('user_id', sa.String(), nullable=False),
    sa.Column('workspace_id', sa.String(), nullable=False),
    sa.Column('role', sa.String(), nullable=True),
    sa.Column('joined_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['workspace_id'], ['workspaces.id'], ),
    sa.PrimaryKeyConstraint('user_id', 'workspace_id')
    )
    op.create_table('workflow_collaboration_sessions',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('session_id', sa.String(), nullable=False),
    sa.Column('workflow_id', sa.String(), nullable=False),
    sa.Column('created_by', sa.String(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('active_users', sa.JSON(), nullable=True),
    sa.Column('last_activity', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('collaboration_mode', sa.String(), nullable=True),
    sa.Column('max_users', sa.Integer(), nullable=True),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_workflow_collaboration_sessions_active', 'workflow_collaboration_sessions', ['last_activity'], unique=False)
    op.create_index('ix_workflow_collaboration_sessions_created_by', 'workflow_collaboration_sessions', ['created_by'], unique=False)
    op.create_index(op.f('ix_workflow_collaboration_sessions_session_id'), 'workflow_collaboration_sessions', ['session_id'], unique=True)
    op.create_index('ix_workflow_collaboration_sessions_workflow', 'workflow_collaboration_sessions', ['workflow_id'], unique=False)
    op.create_index(op.f('ix_workflow_collaboration_sessions_workflow_id'), 'workflow_collaboration_sessions', ['workflow_id'], unique=False)
    op.create_table('workflow_executions',
    sa.Column('execution_id', sa.String(), nullable=False),
    sa.Column('workflow_id', sa.String(), nullable=False),
    sa.Column('status', sa.String(), nullable=True),
    sa.Column('input_data', sa.Text(), nullable=True),
    sa.Column('steps', sa.Text(), nullable=True),
    sa.Column('outputs', sa.Text(), nullable=True),
    sa.Column('context', sa.Text(), nullable=True),
    sa.Column('version', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('error', sa.Text(), nullable=True),
    sa.Column('user_id', sa.String(), nullable=True),
    sa.Column('visibility', sa.String(), nullable=False),
    sa.Column('owner_id', sa.String(), nullable=True),
    sa.Column('team_id', sa.String(), nullable=True),
    sa.ForeignKeyConstraint(['owner_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['team_id'], ['teams.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('execution_id')
    )
    op.create_index(op.f('ix_workflow_executions_owner_id'), 'workflow_executions', ['owner_id'], unique=False)
    op.create_index(op.f('ix_workflow_executions_status'), 'workflow_executions', ['status'], unique=False)
    op.create_index(op.f('ix_workflow_executions_team_id'), 'workflow_executions', ['team_id'], unique=False)
    op.create_index(op.f('ix_workflow_executions_user_id'), 'workflow_executions', ['user_id'], unique=False)
    op.create_index(op.f('ix_workflow_executions_visibility'), 'workflow_executions', ['visibility'], unique=False)
    op.create_index(op.f('ix_workflow_executions_workflow_id'), 'workflow_executions', ['workflow_id'], unique=False)
    op.create_table('workflow_shares',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('share_id', sa.String(), nullable=False),
    sa.Column('workflow_id', sa.String(), nullable=False),
    sa.Column('created_by', sa.String(), nullable=False),
    sa.Column('share_link', sa.String(), nullable=False),
    sa.Column('share_type', sa.String(), nullable=True),
    sa.Column('permissions', sa.JSON(), nullable=True),
    sa.Column('expires_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('max_uses', sa.Integer(), nullable=True),
    sa.Column('use_count', sa.Integer(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('revoked_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('revoked_by', sa.String(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('last_accessed', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['revoked_by'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('share_link')
    )
    op.create_index(op.f('ix_workflow_shares_created_by'), 'workflow_shares', ['created_by'], unique=False)
    op.create_index('ix_workflow_shares_expires', 'workflow_shares', ['expires_at', 'is_active'], unique=False)
    op.create_index(op.f('ix_workflow_shares_expires_at'), 'workflow_shares', ['expires_at'], unique=False)
    op.create_index(op.f('ix_workflow_shares_is_active'), 'workflow_shares', ['is_active'], unique=False)
    op.create_index(op.f('ix_workflow_shares_share_id'), 'workflow_shares', ['share_id'], unique=True)
    op.create_index('ix_workflow_shares_workflow', 'workflow_shares', ['workflow_id', 'is_active'], unique=False)
    op.create_index(op.f('ix_workflow_shares_workflow_id'), 'workflow_shares', ['workflow_id'], unique=False)
    op.create_table('workflow_templates',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('template_id', sa.String(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('category', sa.String(), nullable=False),
    sa.Column('complexity', sa.String(), nullable=False),
    sa.Column('tags', sa.JSON(), nullable=True),
    sa.Column('author_id', sa.String(), nullable=True),
    sa.Column('is_public', sa.Boolean(), nullable=True),
    sa.Column('is_featured', sa.Boolean(), nullable=True),
    sa.Column('template_json', sa.JSON(), nullable=False),
    sa.Column('inputs_schema', sa.JSON(), nullable=True),
    sa.Column('steps_schema', sa.JSON(), nullable=True),
    sa.Column('output_schema', sa.JSON(), nullable=True),
    sa.Column('usage_count', sa.Integer(), nullable=True),
    sa.Column('rating_sum', sa.Integer(), nullable=True),
    sa.Column('rating_count', sa.Integer(), nullable=True),
    sa.Column('version', sa.String(), nullable=True),
    sa.Column('parent_template_id', sa.String(), nullable=True),
    sa.Column('estimated_duration_seconds', sa.Integer(), nullable=True),
    sa.Column('prerequisites', sa.JSON(), nullable=True),
    sa.Column('dependencies', sa.JSON(), nullable=True),
    sa.Column('permissions', sa.JSON(), nullable=True),
    sa.Column('license', sa.String(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['author_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['parent_template_id'], ['workflow_templates.template_id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_workflow_templates_author_id'), 'workflow_templates', ['author_id'], unique=False)
    op.create_index('ix_workflow_templates_author_public', 'workflow_templates', ['author_id', 'is_public'], unique=False)
    op.create_index('ix_workflow_templates_category_complexity', 'workflow_templates', ['category', 'complexity'], unique=False)
    op.create_index(op.f('ix_workflow_templates_created_at'), 'workflow_templates', ['created_at'], unique=False)
    op.create_index(op.f('ix_workflow_templates_is_featured'), 'workflow_templates', ['is_featured'], unique=False)
    op.create_index(op.f('ix_workflow_templates_is_public'), 'workflow_templates', ['is_public'], unique=False)
    op.create_index('ix_workflow_templates_public_featured', 'workflow_templates', ['is_public', 'is_featured'], unique=False)
    op.create_index(op.f('ix_workflow_templates_template_id'), 'workflow_templates', ['template_id'], unique=True)
    op.create_table('ab_tests',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('status', sa.String(), nullable=True),
    sa.Column('test_type', sa.String(), nullable=False),
    sa.Column('agent_id', sa.String(), nullable=True),
    sa.Column('traffic_percentage', sa.Float(), nullable=True),
    sa.Column('variant_a_name', sa.String(), nullable=True),
    sa.Column('variant_b_name', sa.String(), nullable=True),
    sa.Column('variant_a_config', sa.JSON(), nullable=True),
    sa.Column('variant_b_config', sa.JSON(), nullable=True),
    sa.Column('primary_metric', sa.String(), nullable=False),
    sa.Column('secondary_metrics', sa.JSON(), nullable=True),
    sa.Column('min_sample_size', sa.Integer(), nullable=True),
    sa.Column('confidence_level', sa.Float(), nullable=True),
    sa.Column('statistical_significance_threshold', sa.Float(), nullable=True),
    sa.Column('variant_a_metrics', sa.JSON(), nullable=True),
    sa.Column('variant_b_metrics', sa.JSON(), nullable=True),
    sa.Column('statistical_significance', sa.Float(), nullable=True),
    sa.Column('winner', sa.String(), nullable=True),
    sa.Column('started_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('completed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['agent_id'], ['agent_registry.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_ab_tests_agent_id'), 'ab_tests', ['agent_id'], unique=False)
    op.create_table('agent_executions',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('agent_id', sa.String(), nullable=False),
    sa.Column('workspace_id', sa.String(), nullable=True),
    sa.Column('status', sa.String(), nullable=True),
    sa.Column('input_summary', sa.Text(), nullable=True),
    sa.Column('output_summary', sa.Text(), nullable=True),
    sa.Column('triggered_by', sa.String(), nullable=True),
    sa.Column('started_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('completed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('duration_seconds', sa.Float(), nullable=True),
    sa.Column('result_summary', sa.Text(), nullable=True),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.ForeignKeyConstraint(['agent_id'], ['agent_registry.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_agent_executions_agent_id'), 'agent_executions', ['agent_id'], unique=False)
    op.create_index(op.f('ix_agent_executions_workspace_id'), 'agent_executions', ['workspace_id'], unique=False)
    op.create_table('artifacts',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('workspace_id', sa.String(), nullable=False),
    sa.Column('agent_id', sa.String(), nullable=True),
    sa.Column('session_id', sa.String(), nullable=True),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('type', sa.String(), nullable=False),
    sa.Column('content', sa.Text(), nullable=False),
    sa.Column('metadata_json', sa.JSON(), nullable=True),
    sa.Column('version', sa.Integer(), nullable=True),
    sa.Column('is_locked', sa.Boolean(), nullable=True),
    sa.Column('locked_by_user_id', sa.String(), nullable=True),
    sa.Column('author_id', sa.String(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['agent_id'], ['agent_registry.id'], ),
    sa.ForeignKeyConstraint(['author_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['locked_by_user_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['workspace_id'], ['workspaces.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_artifacts_agent_id'), 'artifacts', ['agent_id'], unique=False)
    op.create_index(op.f('ix_artifacts_session_id'), 'artifacts', ['session_id'], unique=False)
    op.create_index(op.f('ix_artifacts_workspace_id'), 'artifacts', ['workspace_id'], unique=False)
    op.create_table('canvas_agent_participants',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('collaboration_session_id', sa.String(), nullable=False),
    sa.Column('agent_id', sa.String(), nullable=False),
    sa.Column('user_id', sa.String(), nullable=False),
    sa.Column('role', sa.String(), nullable=True),
    sa.Column('permissions', sa.JSON(), nullable=True),
    sa.Column('status', sa.String(), nullable=True),
    sa.Column('last_activity_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('actions_count', sa.Integer(), nullable=True),
    sa.Column('held_locks', sa.JSON(), nullable=True),
    sa.Column('joined_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('left_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['agent_id'], ['agent_registry.id'], ),
    sa.ForeignKeyConstraint(['collaboration_session_id'], ['canvas_collaboration_sessions.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_canvas_agent_participants_agent_id'), 'canvas_agent_participants', ['agent_id'], unique=False)
    op.create_index(op.f('ix_canvas_agent_participants_collaboration_session_id'), 'canvas_agent_participants', ['collaboration_session_id'], unique=False)
    op.create_index('ix_canvas_agent_participants_session_agent', 'canvas_agent_participants', ['collaboration_session_id', 'agent_id'], unique=False)
    op.create_index('ix_canvas_agent_participants_session_status', 'canvas_agent_participants', ['collaboration_session_id', 'status'], unique=False)
    op.create_index(op.f('ix_canvas_agent_participants_user_id'), 'canvas_agent_participants', ['user_id'], unique=False)
    op.create_table('canvas_conflicts',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('collaboration_session_id', sa.String(), nullable=False),
    sa.Column('canvas_id', sa.String(), nullable=False),
    sa.Column('component_id', sa.String(), nullable=False),
    sa.Column('agent_a_id', sa.String(), nullable=False),
    sa.Column('agent_b_id', sa.String(), nullable=False),
    sa.Column('agent_a_action', sa.JSON(), nullable=True),
    sa.Column('agent_b_action', sa.JSON(), nullable=True),
    sa.Column('resolution', sa.String(), nullable=False),
    sa.Column('resolved_by', sa.String(), nullable=True),
    sa.Column('resolved_action', sa.JSON(), nullable=True),
    sa.Column('conflict_time', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('resolved_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['agent_a_id'], ['agent_registry.id'], ),
    sa.ForeignKeyConstraint(['agent_b_id'], ['agent_registry.id'], ),
    sa.ForeignKeyConstraint(['collaboration_session_id'], ['canvas_collaboration_sessions.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_canvas_conflicts_agent_a_id'), 'canvas_conflicts', ['agent_a_id'], unique=False)
    op.create_index(op.f('ix_canvas_conflicts_agent_b_id'), 'canvas_conflicts', ['agent_b_id'], unique=False)
    op.create_index(op.f('ix_canvas_conflicts_canvas_id'), 'canvas_conflicts', ['canvas_id'], unique=False)
    op.create_index(op.f('ix_canvas_conflicts_collaboration_session_id'), 'canvas_conflicts', ['collaboration_session_id'], unique=False)
    op.create_index(op.f('ix_canvas_conflicts_conflict_time'), 'canvas_conflicts', ['conflict_time'], unique=False)
    op.create_table('collaboration_audit',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('workflow_id', sa.String(), nullable=False),
    sa.Column('user_id', sa.String(), nullable=False),
    sa.Column('action_type', sa.String(), nullable=False),
    sa.Column('action_details', sa.JSON(), nullable=True),
    sa.Column('resource_type', sa.String(), nullable=True),
    sa.Column('resource_id', sa.String(), nullable=True),
    sa.Column('session_id', sa.String(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['session_id'], ['workflow_collaboration_sessions.session_id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_collaboration_audit_action', 'collaboration_audit', ['action_type', 'created_at'], unique=False)
    op.create_index(op.f('ix_collaboration_audit_action_type'), 'collaboration_audit', ['action_type'], unique=False)
    op.create_index(op.f('ix_collaboration_audit_created_at'), 'collaboration_audit', ['created_at'], unique=False)
    op.create_index(op.f('ix_collaboration_audit_session_id'), 'collaboration_audit', ['session_id'], unique=False)
    op.create_index('ix_collaboration_audit_user', 'collaboration_audit', ['user_id', 'created_at'], unique=False)
    op.create_index(op.f('ix_collaboration_audit_user_id'), 'collaboration_audit', ['user_id'], unique=False)
    op.create_index('ix_collaboration_audit_workflow', 'collaboration_audit', ['workflow_id'], unique=False)
    op.create_index(op.f('ix_collaboration_audit_workflow_id'), 'collaboration_audit', ['workflow_id'], unique=False)
    op.create_table('collaboration_session_participants',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('session_id', sa.String(), nullable=False),
    sa.Column('user_id', sa.String(), nullable=False),
    sa.Column('joined_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('last_heartbeat', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('cursor_position', sa.JSON(), nullable=True),
    sa.Column('selected_node', sa.String(), nullable=True),
    sa.Column('user_name', sa.String(), nullable=True),
    sa.Column('user_color', sa.String(), nullable=True),
    sa.Column('role', sa.String(), nullable=True),
    sa.Column('can_edit', sa.Boolean(), nullable=True),
    sa.ForeignKeyConstraint(['session_id'], ['workflow_collaboration_sessions.session_id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_collaboration_participants_heartbeat', 'collaboration_session_participants', ['last_heartbeat'], unique=False)
    op.create_index('ix_collaboration_participants_session_user', 'collaboration_session_participants', ['session_id', 'user_id'], unique=True)
    op.create_index(op.f('ix_collaboration_session_participants_session_id'), 'collaboration_session_participants', ['session_id'], unique=False)
    op.create_index(op.f('ix_collaboration_session_participants_user_id'), 'collaboration_session_participants', ['user_id'], unique=False)
    op.create_table('component_usage',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('component_id', sa.String(), nullable=False),
    sa.Column('canvas_id', sa.String(), nullable=False),
    sa.Column('session_id', sa.String(), nullable=True),
    sa.Column('user_id', sa.String(), nullable=False),
    sa.Column('agent_id', sa.String(), nullable=True),
    sa.Column('props_passed', sa.JSON(), nullable=True),
    sa.Column('rendering_time_ms', sa.Integer(), nullable=True),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('governance_check_passed', sa.Boolean(), nullable=True),
    sa.Column('agent_maturity_level', sa.String(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['agent_id'], ['agent_registry.id'], ),
    sa.ForeignKeyConstraint(['component_id'], ['custom_components.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_component_usage_agent_id'), 'component_usage', ['agent_id'], unique=False)
    op.create_index(op.f('ix_component_usage_canvas_id'), 'component_usage', ['canvas_id'], unique=False)
    op.create_index('ix_component_usage_component_canvas', 'component_usage', ['component_id', 'canvas_id'], unique=False)
    op.create_index(op.f('ix_component_usage_component_id'), 'component_usage', ['component_id'], unique=False)
    op.create_index(op.f('ix_component_usage_created_at'), 'component_usage', ['created_at'], unique=False)
    op.create_index('ix_component_usage_session', 'component_usage', ['session_id'], unique=False)
    op.create_index(op.f('ix_component_usage_session_id'), 'component_usage', ['session_id'], unique=False)
    op.create_index(op.f('ix_component_usage_user_id'), 'component_usage', ['user_id'], unique=False)
    op.create_table('component_versions',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('component_id', sa.String(), nullable=False),
    sa.Column('version_number', sa.Integer(), nullable=False),
    sa.Column('html_content', sa.Text(), nullable=True),
    sa.Column('css_content', sa.Text(), nullable=True),
    sa.Column('js_content', sa.Text(), nullable=True),
    sa.Column('props_schema', sa.JSON(), nullable=True),
    sa.Column('default_props', sa.JSON(), nullable=True),
    sa.Column('dependencies', sa.JSON(), nullable=True),
    sa.Column('change_description', sa.Text(), nullable=True),
    sa.Column('changed_by', sa.String(), nullable=True),
    sa.Column('change_type', sa.String(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['changed_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['component_id'], ['custom_components.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_component_versions_component_id'), 'component_versions', ['component_id'], unique=False)
    op.create_index('ix_component_versions_component_version', 'component_versions', ['component_id', 'version_number'], unique=True)
    op.create_index(op.f('ix_component_versions_created_at'), 'component_versions', ['created_at'], unique=False)
    op.create_table('edit_locks',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('session_id', sa.String(), nullable=False),
    sa.Column('workflow_id', sa.String(), nullable=False),
    sa.Column('resource_type', sa.String(), nullable=False),
    sa.Column('resource_id', sa.String(), nullable=False),
    sa.Column('locked_by', sa.String(), nullable=False),
    sa.Column('locked_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('expires_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('lock_reason', sa.String(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.ForeignKeyConstraint(['locked_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['session_id'], ['workflow_collaboration_sessions.session_id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_edit_locks_expiry', 'edit_locks', ['expires_at', 'is_active'], unique=False)
    op.create_index(op.f('ix_edit_locks_is_active'), 'edit_locks', ['is_active'], unique=False)
    op.create_index(op.f('ix_edit_locks_locked_by'), 'edit_locks', ['locked_by'], unique=False)
    op.create_index('ix_edit_locks_resource', 'edit_locks', ['resource_type', 'resource_id', 'is_active'], unique=False)
    op.create_index(op.f('ix_edit_locks_resource_id'), 'edit_locks', ['resource_id'], unique=False)
    op.create_index(op.f('ix_edit_locks_session_id'), 'edit_locks', ['session_id'], unique=False)
    op.create_index('ix_edit_locks_workflow', 'edit_locks', ['workflow_id', 'is_active'], unique=False)
    op.create_index(op.f('ix_edit_locks_workflow_id'), 'edit_locks', ['workflow_id'], unique=False)
    op.create_table('skill_executions',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('agent_id', sa.String(), nullable=False),
    sa.Column('skill_id', sa.String(), nullable=False),
    sa.Column('workspace_id', sa.String(), nullable=False),
    sa.Column('status', sa.String(), nullable=True),
    sa.Column('input_params', sa.JSON(), nullable=True),
    sa.Column('output_result', sa.JSON(), nullable=True),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('execution_seconds', sa.Float(), nullable=True),
    sa.Column('cpu_count', sa.Integer(), nullable=True),
    sa.Column('memory_mb', sa.Integer(), nullable=True),
    sa.Column('compute_billed', sa.Boolean(), nullable=True),
    sa.Column('machine_id', sa.String(), nullable=True),
    sa.Column('execution_time_ms', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('completed_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['agent_id'], ['agent_registry.id'], ),
    sa.ForeignKeyConstraint(['workspace_id'], ['workspaces.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_skill_executions_agent_id'), 'skill_executions', ['agent_id'], unique=False)
    op.create_index(op.f('ix_skill_executions_skill_id'), 'skill_executions', ['skill_id'], unique=False)
    op.create_index(op.f('ix_skill_executions_workspace_id'), 'skill_executions', ['workspace_id'], unique=False)
    op.create_table('template_executions',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('template_id', sa.String(), nullable=False),
    sa.Column('workflow_id', sa.String(), nullable=False),
    sa.Column('user_id', sa.String(), nullable=False),
    sa.Column('parameters_used', sa.JSON(), nullable=False),
    sa.Column('template_version', sa.String(), nullable=False),
    sa.Column('status', sa.String(), nullable=False),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('started_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('completed_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['template_id'], ['workflow_templates.template_id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_template_executions_template_id'), 'template_executions', ['template_id'], unique=False)
    op.create_index('ix_template_executions_template_status', 'template_executions', ['template_id', 'status'], unique=False)
    op.create_index(op.f('ix_template_executions_user_id'), 'template_executions', ['user_id'], unique=False)
    op.create_index('ix_template_executions_user_status', 'template_executions', ['user_id', 'status'], unique=False)
    op.create_index(op.f('ix_template_executions_workflow_id'), 'template_executions', ['workflow_id'], unique=False)
    op.create_table('template_versions',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('template_id', sa.String(), nullable=False),
    sa.Column('version', sa.String(), nullable=False),
    sa.Column('template_snapshot', sa.JSON(), nullable=False),
    sa.Column('change_description', sa.Text(), nullable=True),
    sa.Column('changed_by_id', sa.String(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['changed_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['template_id'], ['workflow_templates.template_id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_template_versions_template_id'), 'template_versions', ['template_id'], unique=False)
    op.create_index('ix_template_versions_template_version', 'template_versions', ['template_id', 'version'], unique=True)
    op.create_table('workflow_debug_sessions',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('workflow_id', sa.String(), nullable=False),
    sa.Column('execution_id', sa.String(), nullable=True),
    sa.Column('user_id', sa.String(), nullable=False),
    sa.Column('session_name', sa.String(), nullable=True),
    sa.Column('status', sa.String(), nullable=True),
    sa.Column('current_step', sa.Integer(), nullable=True),
    sa.Column('current_node_id', sa.String(), nullable=True),
    sa.Column('breakpoints', sa.JSON(), nullable=True),
    sa.Column('variables', sa.JSON(), nullable=True),
    sa.Column('call_stack', sa.JSON(), nullable=True),
    sa.Column('stop_on_entry', sa.Boolean(), nullable=True),
    sa.Column('stop_on_exceptions', sa.Boolean(), nullable=True),
    sa.Column('stop_on_error', sa.Boolean(), nullable=True),
    sa.Column('conditional_breakpoints', sa.JSON(), nullable=True),
    sa.Column('collaborators', sa.JSON(), nullable=True),
    sa.Column('performance_metrics', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('completed_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['execution_id'], ['workflow_executions.execution_id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_debug_sessions_status', 'workflow_debug_sessions', ['status'], unique=False)
    op.create_index('ix_debug_sessions_user', 'workflow_debug_sessions', ['user_id', 'created_at'], unique=False)
    op.create_index('ix_debug_sessions_workflow', 'workflow_debug_sessions', ['workflow_id'], unique=False)
    op.create_index(op.f('ix_workflow_debug_sessions_execution_id'), 'workflow_debug_sessions', ['execution_id'], unique=False)
    op.create_index(op.f('ix_workflow_debug_sessions_user_id'), 'workflow_debug_sessions', ['user_id'], unique=False)
    op.create_index(op.f('ix_workflow_debug_sessions_workflow_id'), 'workflow_debug_sessions', ['workflow_id'], unique=False)
    op.create_table('workflow_execution_logs',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('execution_id', sa.String(), nullable=False),
    sa.Column('level', sa.String(), nullable=True),
    sa.Column('message', sa.Text(), nullable=False),
    sa.Column('step_id', sa.String(), nullable=True),
    sa.Column('context', sa.JSON(), nullable=True),
    sa.Column('timestamp', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['execution_id'], ['workflow_executions.execution_id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_workflow_execution_logs_execution', 'workflow_execution_logs', ['execution_id'], unique=False)
    op.create_index(op.f('ix_workflow_execution_logs_execution_id'), 'workflow_execution_logs', ['execution_id'], unique=False)
    op.create_index(op.f('ix_workflow_execution_logs_timestamp'), 'workflow_execution_logs', ['timestamp'], unique=False)
    op.create_table('workflow_snapshots',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('execution_id', sa.String(), nullable=False),
    sa.Column('step_id', sa.String(), nullable=False),
    sa.Column('step_order', sa.Integer(), nullable=False),
    sa.Column('context_snapshot', sa.Text(), nullable=False),
    sa.Column('status', sa.String(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['execution_id'], ['workflow_executions.execution_id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_workflow_snapshots_execution_id'), 'workflow_snapshots', ['execution_id'], unique=False)
    op.create_table('workflow_step_executions',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('execution_id', sa.String(), nullable=False),
    sa.Column('workflow_id', sa.String(), nullable=False),
    sa.Column('step_id', sa.String(), nullable=False),
    sa.Column('step_name', sa.String(), nullable=False),
    sa.Column('step_type', sa.String(), nullable=False),
    sa.Column('sequence_order', sa.Integer(), nullable=False),
    sa.Column('status', sa.String(), nullable=True),
    sa.Column('input_data', sa.JSON(), nullable=True),
    sa.Column('output_data', sa.JSON(), nullable=True),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('started_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('completed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('duration_ms', sa.Integer(), nullable=True),
    sa.Column('retry_count', sa.Integer(), nullable=True),
    sa.Column('metadata_json', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['execution_id'], ['workflow_executions.execution_id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_workflow_step_executions_execution', 'workflow_step_executions', ['execution_id'], unique=False)
    op.create_index(op.f('ix_workflow_step_executions_execution_id'), 'workflow_step_executions', ['execution_id'], unique=False)
    op.create_index('ix_workflow_step_executions_step', 'workflow_step_executions', ['step_id'], unique=False)
    op.create_index(op.f('ix_workflow_step_executions_step_id'), 'workflow_step_executions', ['step_id'], unique=False)
    op.create_index(op.f('ix_workflow_step_executions_workflow_id'), 'workflow_step_executions', ['workflow_id'], unique=False)
    op.create_table('ab_test_participants',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('test_id', sa.String(), nullable=False),
    sa.Column('user_id', sa.String(), nullable=False),
    sa.Column('session_id', sa.String(), nullable=True),
    sa.Column('assigned_variant', sa.String(), nullable=False),
    sa.Column('assigned_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('success', sa.Boolean(), nullable=True),
    sa.Column('metric_value', sa.Float(), nullable=True),
    sa.Column('recorded_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('meta_data', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['test_id'], ['ab_tests.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_ab_test_participants_session_id'), 'ab_test_participants', ['session_id'], unique=False)
    op.create_index(op.f('ix_ab_test_participants_test_id'), 'ab_test_participants', ['test_id'], unique=False)
    op.create_index('ix_ab_test_participants_test_variant', 'ab_test_participants', ['test_id', 'assigned_variant'], unique=False)
    op.create_index(op.f('ix_ab_test_participants_user_id'), 'ab_test_participants', ['user_id'], unique=False)
    op.create_table('agent_feedback',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('agent_id', sa.String(), nullable=False),
    sa.Column('agent_execution_id', sa.String(), nullable=True),
    sa.Column('user_id', sa.String(), nullable=False),
    sa.Column('input_context', sa.Text(), nullable=True),
    sa.Column('original_output', sa.Text(), nullable=False),
    sa.Column('user_correction', sa.Text(), nullable=False),
    sa.Column('feedback_type', sa.String(), nullable=True),
    sa.Column('thumbs_up_down', sa.Boolean(), nullable=True),
    sa.Column('rating', sa.Integer(), nullable=True),
    sa.Column('status', sa.String(), nullable=True),
    sa.Column('ai_reasoning', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('adjudicated_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['agent_execution_id'], ['agent_executions.id'], ),
    sa.ForeignKeyConstraint(['agent_id'], ['agent_registry.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_agent_feedback_agent_execution_id'), 'agent_feedback', ['agent_execution_id'], unique=False)
    op.create_index(op.f('ix_agent_feedback_feedback_type'), 'agent_feedback', ['feedback_type'], unique=False)
    op.create_index(op.f('ix_agent_feedback_rating'), 'agent_feedback', ['rating'], unique=False)
    op.create_table('agent_trace_steps',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('execution_id', sa.String(), nullable=False),
    sa.Column('step_number', sa.Integer(), nullable=False),
    sa.Column('thought', sa.Text(), nullable=True),
    sa.Column('action', sa.JSON(), nullable=True),
    sa.Column('observation', sa.Text(), nullable=True),
    sa.Column('final_answer', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['execution_id'], ['agent_executions.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_agent_trace_steps_execution_id'), 'agent_trace_steps', ['execution_id'], unique=False)
    op.create_table('artifact_versions',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('artifact_id', sa.String(), nullable=False),
    sa.Column('version', sa.Integer(), nullable=False),
    sa.Column('content', sa.Text(), nullable=False),
    sa.Column('metadata_json', sa.JSON(), nullable=True),
    sa.Column('author_id', sa.String(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('url', sa.String(), nullable=True),
    sa.Column('title', sa.String(), nullable=True),
    sa.Column('status', sa.String(), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('closed_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['artifact_id'], ['artifacts.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['author_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_artifact_versions_artifact_id'), 'artifact_versions', ['artifact_id'], unique=False)
    op.create_table('browser_sessions',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('session_id', sa.String(), nullable=False),
    sa.Column('workspace_id', sa.String(), nullable=True),
    sa.Column('agent_id', sa.String(), nullable=True),
    sa.Column('agent_execution_id', sa.String(), nullable=True),
    sa.ForeignKeyConstraint(['agent_execution_id'], ['agent_executions.id'], ),
    sa.ForeignKeyConstraint(['agent_id'], ['agent_registry.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_browser_sessions_agent_execution_id'), 'browser_sessions', ['agent_execution_id'], unique=False)
    op.create_index(op.f('ix_browser_sessions_agent_id'), 'browser_sessions', ['agent_id'], unique=False)
    op.create_index(op.f('ix_browser_sessions_session_id'), 'browser_sessions', ['session_id'], unique=True)
    op.create_index(op.f('ix_browser_sessions_workspace_id'), 'browser_sessions', ['workspace_id'], unique=False)
    op.create_table('deep_link_audit',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('workspace_id', sa.String(), nullable=True),
    sa.Column('agent_id', sa.String(), nullable=True),
    sa.Column('agent_execution_id', sa.String(), nullable=True),
    sa.Column('user_id', sa.String(), nullable=False),
    sa.Column('resource_type', sa.String(), nullable=False),
    sa.Column('resource_id', sa.String(), nullable=False),
    sa.Column('action', sa.String(), nullable=False),
    sa.Column('source', sa.String(), nullable=True),
    sa.Column('deeplink_url', sa.Text(), nullable=False),
    sa.Column('parameters', sa.JSON(), nullable=True),
    sa.Column('status', sa.String(), nullable=True),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('governance_check_passed', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['agent_execution_id'], ['agent_executions.id'], ),
    sa.ForeignKeyConstraint(['agent_id'], ['agent_registry.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_deep_link_audit_agent_execution_id'), 'deep_link_audit', ['agent_execution_id'], unique=False)
    op.create_index(op.f('ix_deep_link_audit_agent_id'), 'deep_link_audit', ['agent_id'], unique=False)
    op.create_index(op.f('ix_deep_link_audit_created_at'), 'deep_link_audit', ['created_at'], unique=False)
    op.create_index(op.f('ix_deep_link_audit_user_id'), 'deep_link_audit', ['user_id'], unique=False)
    op.create_index(op.f('ix_deep_link_audit_workspace_id'), 'deep_link_audit', ['workspace_id'], unique=False)
    op.create_table('device_sessions',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('session_id', sa.String(), nullable=False),
    sa.Column('workspace_id', sa.String(), nullable=True),
    sa.Column('device_node_id', sa.String(), nullable=False),
    sa.Column('agent_id', sa.String(), nullable=True),
    sa.Column('agent_execution_id', sa.String(), nullable=True),
    sa.Column('user_id', sa.String(), nullable=False),
    sa.Column('session_type', sa.String(), nullable=False),
    sa.Column('status', sa.String(), nullable=True),
    sa.Column('configuration', sa.JSON(), nullable=True),
    sa.Column('metadata_json', sa.JSON(), nullable=True),
    sa.Column('governance_check_passed', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('closed_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['agent_execution_id'], ['agent_executions.id'], ),
    sa.ForeignKeyConstraint(['agent_id'], ['agent_registry.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_device_sessions_agent_execution_id'), 'device_sessions', ['agent_execution_id'], unique=False)
    op.create_index(op.f('ix_device_sessions_agent_id'), 'device_sessions', ['agent_id'], unique=False)
    op.create_index(op.f('ix_device_sessions_device_node_id'), 'device_sessions', ['device_node_id'], unique=False)
    op.create_index(op.f('ix_device_sessions_session_id'), 'device_sessions', ['session_id'], unique=True)
    op.create_index(op.f('ix_device_sessions_user_id'), 'device_sessions', ['user_id'], unique=False)
    op.create_index(op.f('ix_device_sessions_workspace_id'), 'device_sessions', ['workspace_id'], unique=False)
    op.create_table('execution_traces',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('workflow_id', sa.String(), nullable=False),
    sa.Column('execution_id', sa.String(), nullable=False),
    sa.Column('debug_session_id', sa.String(), nullable=True),
    sa.Column('step_number', sa.Integer(), nullable=False),
    sa.Column('node_id', sa.String(), nullable=False),
    sa.Column('node_type', sa.String(), nullable=False),
    sa.Column('status', sa.String(), nullable=False),
    sa.Column('input_data', sa.JSON(), nullable=True),
    sa.Column('output_data', sa.JSON(), nullable=True),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('variables_before', sa.JSON(), nullable=True),
    sa.Column('variables_after', sa.JSON(), nullable=True),
    sa.Column('variable_changes', sa.JSON(), nullable=True),
    sa.Column('started_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('completed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('duration_ms', sa.Integer(), nullable=True),
    sa.Column('parent_step_id', sa.String(), nullable=True),
    sa.Column('thread_id', sa.String(), nullable=True),
    sa.ForeignKeyConstraint(['debug_session_id'], ['workflow_debug_sessions.id'], ),
    sa.ForeignKeyConstraint(['execution_id'], ['workflow_executions.execution_id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_execution_traces_debug_session_id'), 'execution_traces', ['debug_session_id'], unique=False)
    op.create_index(op.f('ix_execution_traces_execution_id'), 'execution_traces', ['execution_id'], unique=False)
    op.create_index(op.f('ix_execution_traces_node_id'), 'execution_traces', ['node_id'], unique=False)
    op.create_index(op.f('ix_execution_traces_step_number'), 'execution_traces', ['step_number'], unique=False)
    op.create_index(op.f('ix_execution_traces_workflow_id'), 'execution_traces', ['workflow_id'], unique=False)
    op.create_index('ix_traces_debug_session', 'execution_traces', ['debug_session_id'], unique=False)
    op.create_index('ix_traces_execution', 'execution_traces', ['execution_id', 'step_number'], unique=False)
    op.create_index('ix_traces_node', 'execution_traces', ['node_id'], unique=False)
    op.create_index('ix_traces_workflow', 'execution_traces', ['workflow_id'], unique=False)
    op.create_table('workflow_breakpoints',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('workflow_id', sa.String(), nullable=False),
    sa.Column('debug_session_id', sa.String(), nullable=True),
    sa.Column('node_id', sa.String(), nullable=False),
    sa.Column('edge_id', sa.String(), nullable=True),
    sa.Column('breakpoint_type', sa.String(), nullable=True),
    sa.Column('condition', sa.Text(), nullable=True),
    sa.Column('hit_count', sa.Integer(), nullable=True),
    sa.Column('hit_limit', sa.Integer(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('is_disabled', sa.Boolean(), nullable=True),
    sa.Column('log_message', sa.Text(), nullable=True),
    sa.Column('created_by', sa.String(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['debug_session_id'], ['workflow_debug_sessions.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_breakpoints_node', 'workflow_breakpoints', ['node_id'], unique=False)
    op.create_index('ix_breakpoints_session', 'workflow_breakpoints', ['debug_session_id'], unique=False)
    op.create_index('ix_breakpoints_workflow', 'workflow_breakpoints', ['workflow_id', 'is_active'], unique=False)
    op.create_index(op.f('ix_workflow_breakpoints_debug_session_id'), 'workflow_breakpoints', ['debug_session_id'], unique=False)
    op.create_index(op.f('ix_workflow_breakpoints_edge_id'), 'workflow_breakpoints', ['edge_id'], unique=False)
    op.create_index(op.f('ix_workflow_breakpoints_is_active'), 'workflow_breakpoints', ['is_active'], unique=False)
    op.create_index(op.f('ix_workflow_breakpoints_node_id'), 'workflow_breakpoints', ['node_id'], unique=False)
    op.create_index(op.f('ix_workflow_breakpoints_workflow_id'), 'workflow_breakpoints', ['workflow_id'], unique=False)
    op.create_table('browser_audit',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('workspace_id', sa.String(), nullable=True),
    sa.Column('agent_id', sa.String(), nullable=True),
    sa.Column('agent_execution_id', sa.String(), nullable=True),
    sa.Column('user_id', sa.String(), nullable=False),
    sa.Column('session_id', sa.String(), nullable=False),
    sa.Column('action_type', sa.String(), nullable=False),
    sa.Column('action_target', sa.Text(), nullable=True),
    sa.Column('action_params', sa.JSON(), nullable=True),
    sa.Column('success', sa.Boolean(), nullable=False),
    sa.Column('result_summary', sa.Text(), nullable=True),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('result_data', sa.JSON(), nullable=True),
    sa.Column('duration_ms', sa.Integer(), nullable=True),
    sa.Column('governance_check_passed', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=True),
    sa.ForeignKeyConstraint(['session_id'], ['browser_sessions.session_id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_browser_audit_agent_execution_id'), 'browser_audit', ['agent_execution_id'], unique=False)
    op.create_index(op.f('ix_browser_audit_agent_id'), 'browser_audit', ['agent_id'], unique=False)
    op.create_index(op.f('ix_browser_audit_created_at'), 'browser_audit', ['created_at'], unique=False)
    op.create_index(op.f('ix_browser_audit_session_id'), 'browser_audit', ['session_id'], unique=False)
    op.create_index(op.f('ix_browser_audit_user_id'), 'browser_audit', ['user_id'], unique=False)
    op.create_index(op.f('ix_browser_audit_workspace_id'), 'browser_audit', ['workspace_id'], unique=False)
    op.create_table('debug_variables',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('trace_id', sa.String(), nullable=False),
    sa.Column('debug_session_id', sa.String(), nullable=True),
    sa.Column('variable_name', sa.String(), nullable=False),
    sa.Column('variable_path', sa.String(), nullable=False),
    sa.Column('variable_type', sa.String(), nullable=False),
    sa.Column('value', sa.JSON(), nullable=True),
    sa.Column('value_preview', sa.Text(), nullable=True),
    sa.Column('is_mutable', sa.Boolean(), nullable=True),
    sa.Column('scope', sa.String(), nullable=True),
    sa.Column('is_changed', sa.Boolean(), nullable=True),
    sa.Column('previous_value', sa.JSON(), nullable=True),
    sa.Column('is_watch', sa.Boolean(), nullable=True),
    sa.Column('watch_expression', sa.Text(), nullable=True),
    sa.ForeignKeyConstraint(['debug_session_id'], ['workflow_debug_sessions.id'], ),
    sa.ForeignKeyConstraint(['trace_id'], ['execution_traces.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_debug_variables_debug_session_id'), 'debug_variables', ['debug_session_id'], unique=False)
    op.create_index('ix_debug_variables_name', 'debug_variables', ['variable_name'], unique=False)
    op.create_index('ix_debug_variables_session', 'debug_variables', ['debug_session_id'], unique=False)
    op.create_index('ix_debug_variables_trace', 'debug_variables', ['trace_id'], unique=False)
    op.create_index(op.f('ix_debug_variables_trace_id'), 'debug_variables', ['trace_id'], unique=False)
    op.create_index(op.f('ix_debug_variables_variable_name'), 'debug_variables', ['variable_name'], unique=False)
    op.alter_column('audit_logs', 'timestamp',
               existing_type=sa.DATETIME(),
               nullable=True)
    op.drop_index('ix_audit_logs_timestamp', table_name='audit_logs')
    op.create_foreign_key(None, 'audit_logs', 'workspaces', ['workspace_id'], ['id'])
    op.add_column('team_members', sa.Column('role', sa.String(), nullable=True))
    op.alter_column('teams', 'description',
               existing_type=sa.VARCHAR(),
               type_=sa.Text(),
               existing_nullable=True)
    op.alter_column('teams', 'created_at',
               existing_type=sa.DATETIME(),
               nullable=True)
    op.alter_column('teams', 'updated_at',
               existing_type=sa.DATETIME(),
               nullable=True)
    op.add_column('users', sa.Column('password_hash', sa.String(), nullable=True))
    op.add_column('users', sa.Column('specialty', sa.String(), nullable=True))
    op.add_column('users', sa.Column('email_verified', sa.Boolean(), nullable=True))
    op.add_column('users', sa.Column('tenant_id', sa.String(), nullable=True))
    op.add_column('users', sa.Column('skills', sa.Text(), nullable=True))
    op.add_column('users', sa.Column('onboarding_completed', sa.Boolean(), nullable=True))
    op.add_column('users', sa.Column('onboarding_step', sa.String(), nullable=True))
    op.add_column('users', sa.Column('capacity_hours', sa.Float(), nullable=True))
    op.add_column('users', sa.Column('hourly_cost_rate', sa.Float(), nullable=True))
    op.add_column('users', sa.Column('metadata_json', sa.JSON(), nullable=True))
    op.add_column('users', sa.Column('preferences', sa.JSON(), nullable=True))
    op.add_column('users', sa.Column('two_factor_enabled', sa.Boolean(), nullable=True))
    op.add_column('users', sa.Column('two_factor_secret', sa.String(), nullable=True))
    op.add_column('users', sa.Column('two_factor_backup_codes', sa.JSON(), nullable=True))
    op.alter_column('users', 'first_name',
               existing_type=sa.VARCHAR(),
               nullable=True)
    op.alter_column('users', 'last_name',
               existing_type=sa.VARCHAR(),
               nullable=True)
    op.alter_column('users', 'role',
               existing_type=sa.VARCHAR(),
               nullable=True)
    op.alter_column('users', 'status',
               existing_type=sa.VARCHAR(),
               nullable=True)
    op.alter_column('users', 'created_at',
               existing_type=sa.DATETIME(),
               nullable=True)
    op.alter_column('users', 'updated_at',
               existing_type=sa.DATETIME(),
               nullable=True)
    op.create_index(op.f('ix_users_tenant_id'), 'users', ['tenant_id'], unique=False)
    op.drop_constraint(None, 'users', type_='foreignkey')
    op.create_foreign_key(None, 'users', 'tenants', ['tenant_id'], ['id'])
    op.drop_column('users', 'hashed_password')
    op.drop_column('users', 'workspace_id')
    op.add_column('workspaces', sa.Column('satellite_api_key', sa.String(), nullable=True))
    op.add_column('workspaces', sa.Column('is_startup', sa.Boolean(), nullable=True))
    op.add_column('workspaces', sa.Column('learning_phase_completed', sa.Boolean(), nullable=True))
    op.add_column('workspaces', sa.Column('metadata_json', sa.JSON(), nullable=True))
    op.alter_column('workspaces', 'description',
               existing_type=sa.VARCHAR(),
               type_=sa.Text(),
               existing_nullable=True)
    op.alter_column('workspaces', 'status',
               existing_type=sa.VARCHAR(),
               nullable=True)
    op.alter_column('workspaces', 'plan_tier',
               existing_type=sa.VARCHAR(),
               nullable=True)
    op.alter_column('workspaces', 'created_at',
               existing_type=sa.DATETIME(),
               nullable=True)
    op.alter_column('workspaces', 'updated_at',
               existing_type=sa.DATETIME(),
               nullable=True)
    op.create_index(op.f('ix_workspaces_satellite_api_key'), 'workspaces', ['satellite_api_key'], unique=True)
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('ix_workspaces_satellite_api_key'), table_name='workspaces')
    op.alter_column('workspaces', 'updated_at',
               existing_type=sa.DATETIME(),
               nullable=False)
    op.alter_column('workspaces', 'created_at',
               existing_type=sa.DATETIME(),
               nullable=False)
    op.alter_column('workspaces', 'plan_tier',
               existing_type=sa.VARCHAR(),
               nullable=False)
    op.alter_column('workspaces', 'status',
               existing_type=sa.VARCHAR(),
               nullable=False)
    op.alter_column('workspaces', 'description',
               existing_type=sa.Text(),
               type_=sa.VARCHAR(),
               existing_nullable=True)
    op.drop_column('workspaces', 'metadata_json')
    op.drop_column('workspaces', 'learning_phase_completed')
    op.drop_column('workspaces', 'is_startup')
    op.drop_column('workspaces', 'satellite_api_key')
    op.add_column('users', sa.Column('workspace_id', sa.VARCHAR(), nullable=True))
    op.add_column('users', sa.Column('hashed_password', sa.VARCHAR(), nullable=True))
    op.drop_constraint(None, 'users', type_='foreignkey')
    op.create_foreign_key(None, 'users', 'workspaces', ['workspace_id'], ['id'])
    op.drop_index(op.f('ix_users_tenant_id'), table_name='users')
    op.alter_column('users', 'updated_at',
               existing_type=sa.DATETIME(),
               nullable=False)
    op.alter_column('users', 'created_at',
               existing_type=sa.DATETIME(),
               nullable=False)
    op.alter_column('users', 'status',
               existing_type=sa.VARCHAR(),
               nullable=False)
    op.alter_column('users', 'role',
               existing_type=sa.VARCHAR(),
               nullable=False)
    op.alter_column('users', 'last_name',
               existing_type=sa.VARCHAR(),
               nullable=False)
    op.alter_column('users', 'first_name',
               existing_type=sa.VARCHAR(),
               nullable=False)
    op.drop_column('users', 'two_factor_backup_codes')
    op.drop_column('users', 'two_factor_secret')
    op.drop_column('users', 'two_factor_enabled')
    op.drop_column('users', 'preferences')
    op.drop_column('users', 'metadata_json')
    op.drop_column('users', 'hourly_cost_rate')
    op.drop_column('users', 'capacity_hours')
    op.drop_column('users', 'onboarding_step')
    op.drop_column('users', 'onboarding_completed')
    op.drop_column('users', 'skills')
    op.drop_column('users', 'tenant_id')
    op.drop_column('users', 'email_verified')
    op.drop_column('users', 'specialty')
    op.drop_column('users', 'password_hash')
    op.alter_column('teams', 'updated_at',
               existing_type=sa.DATETIME(),
               nullable=False)
    op.alter_column('teams', 'created_at',
               existing_type=sa.DATETIME(),
               nullable=False)
    op.alter_column('teams', 'description',
               existing_type=sa.Text(),
               type_=sa.VARCHAR(),
               existing_nullable=True)
    op.drop_column('team_members', 'role')
    op.drop_constraint(None, 'audit_logs', type_='foreignkey')
    op.create_index('ix_audit_logs_timestamp', 'audit_logs', ['timestamp'], unique=False)
    op.alter_column('audit_logs', 'timestamp',
               existing_type=sa.DATETIME(),
               nullable=False)
    op.drop_index(op.f('ix_debug_variables_variable_name'), table_name='debug_variables')
    op.drop_index(op.f('ix_debug_variables_trace_id'), table_name='debug_variables')
    op.drop_index('ix_debug_variables_trace', table_name='debug_variables')
    op.drop_index('ix_debug_variables_session', table_name='debug_variables')
    op.drop_index('ix_debug_variables_name', table_name='debug_variables')
    op.drop_index(op.f('ix_debug_variables_debug_session_id'), table_name='debug_variables')
    op.drop_table('debug_variables')
    op.drop_index(op.f('ix_browser_audit_workspace_id'), table_name='browser_audit')
    op.drop_index(op.f('ix_browser_audit_user_id'), table_name='browser_audit')
    op.drop_index(op.f('ix_browser_audit_session_id'), table_name='browser_audit')
    op.drop_index(op.f('ix_browser_audit_created_at'), table_name='browser_audit')
    op.drop_index(op.f('ix_browser_audit_agent_id'), table_name='browser_audit')
    op.drop_index(op.f('ix_browser_audit_agent_execution_id'), table_name='browser_audit')
    op.drop_table('browser_audit')
    op.drop_index(op.f('ix_workflow_breakpoints_workflow_id'), table_name='workflow_breakpoints')
    op.drop_index(op.f('ix_workflow_breakpoints_node_id'), table_name='workflow_breakpoints')
    op.drop_index(op.f('ix_workflow_breakpoints_is_active'), table_name='workflow_breakpoints')
    op.drop_index(op.f('ix_workflow_breakpoints_edge_id'), table_name='workflow_breakpoints')
    op.drop_index(op.f('ix_workflow_breakpoints_debug_session_id'), table_name='workflow_breakpoints')
    op.drop_index('ix_breakpoints_workflow', table_name='workflow_breakpoints')
    op.drop_index('ix_breakpoints_session', table_name='workflow_breakpoints')
    op.drop_index('ix_breakpoints_node', table_name='workflow_breakpoints')
    op.drop_table('workflow_breakpoints')
    op.drop_index('ix_traces_workflow', table_name='execution_traces')
    op.drop_index('ix_traces_node', table_name='execution_traces')
    op.drop_index('ix_traces_execution', table_name='execution_traces')
    op.drop_index('ix_traces_debug_session', table_name='execution_traces')
    op.drop_index(op.f('ix_execution_traces_workflow_id'), table_name='execution_traces')
    op.drop_index(op.f('ix_execution_traces_step_number'), table_name='execution_traces')
    op.drop_index(op.f('ix_execution_traces_node_id'), table_name='execution_traces')
    op.drop_index(op.f('ix_execution_traces_execution_id'), table_name='execution_traces')
    op.drop_index(op.f('ix_execution_traces_debug_session_id'), table_name='execution_traces')
    op.drop_table('execution_traces')
    op.drop_index(op.f('ix_device_sessions_workspace_id'), table_name='device_sessions')
    op.drop_index(op.f('ix_device_sessions_user_id'), table_name='device_sessions')
    op.drop_index(op.f('ix_device_sessions_session_id'), table_name='device_sessions')
    op.drop_index(op.f('ix_device_sessions_device_node_id'), table_name='device_sessions')
    op.drop_index(op.f('ix_device_sessions_agent_id'), table_name='device_sessions')
    op.drop_index(op.f('ix_device_sessions_agent_execution_id'), table_name='device_sessions')
    op.drop_table('device_sessions')
    op.drop_index(op.f('ix_deep_link_audit_workspace_id'), table_name='deep_link_audit')
    op.drop_index(op.f('ix_deep_link_audit_user_id'), table_name='deep_link_audit')
    op.drop_index(op.f('ix_deep_link_audit_created_at'), table_name='deep_link_audit')
    op.drop_index(op.f('ix_deep_link_audit_agent_id'), table_name='deep_link_audit')
    op.drop_index(op.f('ix_deep_link_audit_agent_execution_id'), table_name='deep_link_audit')
    op.drop_table('deep_link_audit')
    op.drop_index(op.f('ix_browser_sessions_workspace_id'), table_name='browser_sessions')
    op.drop_index(op.f('ix_browser_sessions_session_id'), table_name='browser_sessions')
    op.drop_index(op.f('ix_browser_sessions_agent_id'), table_name='browser_sessions')
    op.drop_index(op.f('ix_browser_sessions_agent_execution_id'), table_name='browser_sessions')
    op.drop_table('browser_sessions')
    op.drop_index(op.f('ix_artifact_versions_artifact_id'), table_name='artifact_versions')
    op.drop_table('artifact_versions')
    op.drop_index(op.f('ix_agent_trace_steps_execution_id'), table_name='agent_trace_steps')
    op.drop_table('agent_trace_steps')
    op.drop_index(op.f('ix_agent_feedback_rating'), table_name='agent_feedback')
    op.drop_index(op.f('ix_agent_feedback_feedback_type'), table_name='agent_feedback')
    op.drop_index(op.f('ix_agent_feedback_agent_execution_id'), table_name='agent_feedback')
    op.drop_table('agent_feedback')
    op.drop_index(op.f('ix_ab_test_participants_user_id'), table_name='ab_test_participants')
    op.drop_index('ix_ab_test_participants_test_variant', table_name='ab_test_participants')
    op.drop_index(op.f('ix_ab_test_participants_test_id'), table_name='ab_test_participants')
    op.drop_index(op.f('ix_ab_test_participants_session_id'), table_name='ab_test_participants')
    op.drop_table('ab_test_participants')
    op.drop_index(op.f('ix_workflow_step_executions_workflow_id'), table_name='workflow_step_executions')
    op.drop_index(op.f('ix_workflow_step_executions_step_id'), table_name='workflow_step_executions')
    op.drop_index('ix_workflow_step_executions_step', table_name='workflow_step_executions')
    op.drop_index(op.f('ix_workflow_step_executions_execution_id'), table_name='workflow_step_executions')
    op.drop_index('ix_workflow_step_executions_execution', table_name='workflow_step_executions')
    op.drop_table('workflow_step_executions')
    op.drop_index(op.f('ix_workflow_snapshots_execution_id'), table_name='workflow_snapshots')
    op.drop_table('workflow_snapshots')
    op.drop_index(op.f('ix_workflow_execution_logs_timestamp'), table_name='workflow_execution_logs')
    op.drop_index(op.f('ix_workflow_execution_logs_execution_id'), table_name='workflow_execution_logs')
    op.drop_index('ix_workflow_execution_logs_execution', table_name='workflow_execution_logs')
    op.drop_table('workflow_execution_logs')
    op.drop_index(op.f('ix_workflow_debug_sessions_workflow_id'), table_name='workflow_debug_sessions')
    op.drop_index(op.f('ix_workflow_debug_sessions_user_id'), table_name='workflow_debug_sessions')
    op.drop_index(op.f('ix_workflow_debug_sessions_execution_id'), table_name='workflow_debug_sessions')
    op.drop_index('ix_debug_sessions_workflow', table_name='workflow_debug_sessions')
    op.drop_index('ix_debug_sessions_user', table_name='workflow_debug_sessions')
    op.drop_index('ix_debug_sessions_status', table_name='workflow_debug_sessions')
    op.drop_table('workflow_debug_sessions')
    op.drop_index('ix_template_versions_template_version', table_name='template_versions')
    op.drop_index(op.f('ix_template_versions_template_id'), table_name='template_versions')
    op.drop_table('template_versions')
    op.drop_index(op.f('ix_template_executions_workflow_id'), table_name='template_executions')
    op.drop_index('ix_template_executions_user_status', table_name='template_executions')
    op.drop_index(op.f('ix_template_executions_user_id'), table_name='template_executions')
    op.drop_index('ix_template_executions_template_status', table_name='template_executions')
    op.drop_index(op.f('ix_template_executions_template_id'), table_name='template_executions')
    op.drop_table('template_executions')
    op.drop_index(op.f('ix_skill_executions_workspace_id'), table_name='skill_executions')
    op.drop_index(op.f('ix_skill_executions_skill_id'), table_name='skill_executions')
    op.drop_index(op.f('ix_skill_executions_agent_id'), table_name='skill_executions')
    op.drop_table('skill_executions')
    op.drop_index(op.f('ix_edit_locks_workflow_id'), table_name='edit_locks')
    op.drop_index('ix_edit_locks_workflow', table_name='edit_locks')
    op.drop_index(op.f('ix_edit_locks_session_id'), table_name='edit_locks')
    op.drop_index(op.f('ix_edit_locks_resource_id'), table_name='edit_locks')
    op.drop_index('ix_edit_locks_resource', table_name='edit_locks')
    op.drop_index(op.f('ix_edit_locks_locked_by'), table_name='edit_locks')
    op.drop_index(op.f('ix_edit_locks_is_active'), table_name='edit_locks')
    op.drop_index('ix_edit_locks_expiry', table_name='edit_locks')
    op.drop_table('edit_locks')
    op.drop_index(op.f('ix_component_versions_created_at'), table_name='component_versions')
    op.drop_index('ix_component_versions_component_version', table_name='component_versions')
    op.drop_index(op.f('ix_component_versions_component_id'), table_name='component_versions')
    op.drop_table('component_versions')
    op.drop_index(op.f('ix_component_usage_user_id'), table_name='component_usage')
    op.drop_index(op.f('ix_component_usage_session_id'), table_name='component_usage')
    op.drop_index('ix_component_usage_session', table_name='component_usage')
    op.drop_index(op.f('ix_component_usage_created_at'), table_name='component_usage')
    op.drop_index(op.f('ix_component_usage_component_id'), table_name='component_usage')
    op.drop_index('ix_component_usage_component_canvas', table_name='component_usage')
    op.drop_index(op.f('ix_component_usage_canvas_id'), table_name='component_usage')
    op.drop_index(op.f('ix_component_usage_agent_id'), table_name='component_usage')
    op.drop_table('component_usage')
    op.drop_index(op.f('ix_collaboration_session_participants_user_id'), table_name='collaboration_session_participants')
    op.drop_index(op.f('ix_collaboration_session_participants_session_id'), table_name='collaboration_session_participants')
    op.drop_index('ix_collaboration_participants_session_user', table_name='collaboration_session_participants')
    op.drop_index('ix_collaboration_participants_heartbeat', table_name='collaboration_session_participants')
    op.drop_table('collaboration_session_participants')
    op.drop_index(op.f('ix_collaboration_audit_workflow_id'), table_name='collaboration_audit')
    op.drop_index('ix_collaboration_audit_workflow', table_name='collaboration_audit')
    op.drop_index(op.f('ix_collaboration_audit_user_id'), table_name='collaboration_audit')
    op.drop_index('ix_collaboration_audit_user', table_name='collaboration_audit')
    op.drop_index(op.f('ix_collaboration_audit_session_id'), table_name='collaboration_audit')
    op.drop_index(op.f('ix_collaboration_audit_created_at'), table_name='collaboration_audit')
    op.drop_index(op.f('ix_collaboration_audit_action_type'), table_name='collaboration_audit')
    op.drop_index('ix_collaboration_audit_action', table_name='collaboration_audit')
    op.drop_table('collaboration_audit')
    op.drop_index(op.f('ix_canvas_conflicts_conflict_time'), table_name='canvas_conflicts')
    op.drop_index(op.f('ix_canvas_conflicts_collaboration_session_id'), table_name='canvas_conflicts')
    op.drop_index(op.f('ix_canvas_conflicts_canvas_id'), table_name='canvas_conflicts')
    op.drop_index(op.f('ix_canvas_conflicts_agent_b_id'), table_name='canvas_conflicts')
    op.drop_index(op.f('ix_canvas_conflicts_agent_a_id'), table_name='canvas_conflicts')
    op.drop_table('canvas_conflicts')
    op.drop_index(op.f('ix_canvas_agent_participants_user_id'), table_name='canvas_agent_participants')
    op.drop_index('ix_canvas_agent_participants_session_status', table_name='canvas_agent_participants')
    op.drop_index('ix_canvas_agent_participants_session_agent', table_name='canvas_agent_participants')
    op.drop_index(op.f('ix_canvas_agent_participants_collaboration_session_id'), table_name='canvas_agent_participants')
    op.drop_index(op.f('ix_canvas_agent_participants_agent_id'), table_name='canvas_agent_participants')
    op.drop_table('canvas_agent_participants')
    op.drop_index(op.f('ix_artifacts_workspace_id'), table_name='artifacts')
    op.drop_index(op.f('ix_artifacts_session_id'), table_name='artifacts')
    op.drop_index(op.f('ix_artifacts_agent_id'), table_name='artifacts')
    op.drop_table('artifacts')
    op.drop_index(op.f('ix_agent_executions_workspace_id'), table_name='agent_executions')
    op.drop_index(op.f('ix_agent_executions_agent_id'), table_name='agent_executions')
    op.drop_table('agent_executions')
    op.drop_index(op.f('ix_ab_tests_agent_id'), table_name='ab_tests')
    op.drop_table('ab_tests')
    op.drop_index(op.f('ix_workflow_templates_template_id'), table_name='workflow_templates')
    op.drop_index('ix_workflow_templates_public_featured', table_name='workflow_templates')
    op.drop_index(op.f('ix_workflow_templates_is_public'), table_name='workflow_templates')
    op.drop_index(op.f('ix_workflow_templates_is_featured'), table_name='workflow_templates')
    op.drop_index(op.f('ix_workflow_templates_created_at'), table_name='workflow_templates')
    op.drop_index('ix_workflow_templates_category_complexity', table_name='workflow_templates')
    op.drop_index('ix_workflow_templates_author_public', table_name='workflow_templates')
    op.drop_index(op.f('ix_workflow_templates_author_id'), table_name='workflow_templates')
    op.drop_table('workflow_templates')
    op.drop_index(op.f('ix_workflow_shares_workflow_id'), table_name='workflow_shares')
    op.drop_index('ix_workflow_shares_workflow', table_name='workflow_shares')
    op.drop_index(op.f('ix_workflow_shares_share_id'), table_name='workflow_shares')
    op.drop_index(op.f('ix_workflow_shares_is_active'), table_name='workflow_shares')
    op.drop_index(op.f('ix_workflow_shares_expires_at'), table_name='workflow_shares')
    op.drop_index('ix_workflow_shares_expires', table_name='workflow_shares')
    op.drop_index(op.f('ix_workflow_shares_created_by'), table_name='workflow_shares')
    op.drop_table('workflow_shares')
    op.drop_index(op.f('ix_workflow_executions_workflow_id'), table_name='workflow_executions')
    op.drop_index(op.f('ix_workflow_executions_visibility'), table_name='workflow_executions')
    op.drop_index(op.f('ix_workflow_executions_user_id'), table_name='workflow_executions')
    op.drop_index(op.f('ix_workflow_executions_team_id'), table_name='workflow_executions')
    op.drop_index(op.f('ix_workflow_executions_status'), table_name='workflow_executions')
    op.drop_index(op.f('ix_workflow_executions_owner_id'), table_name='workflow_executions')
    op.drop_table('workflow_executions')
    op.drop_index(op.f('ix_workflow_collaboration_sessions_workflow_id'), table_name='workflow_collaboration_sessions')
    op.drop_index('ix_workflow_collaboration_sessions_workflow', table_name='workflow_collaboration_sessions')
    op.drop_index(op.f('ix_workflow_collaboration_sessions_session_id'), table_name='workflow_collaboration_sessions')
    op.drop_index('ix_workflow_collaboration_sessions_created_by', table_name='workflow_collaboration_sessions')
    op.drop_index('ix_workflow_collaboration_sessions_active', table_name='workflow_collaboration_sessions')
    op.drop_table('workflow_collaboration_sessions')
    op.drop_table('user_workspaces')
    op.drop_table('user_sessions')
    op.drop_index(op.f('ix_user_connections_workspace_id'), table_name='user_connections')
    op.drop_index(op.f('ix_user_connections_user_id'), table_name='user_connections')
    op.drop_index(op.f('ix_user_connections_integration_id'), table_name='user_connections')
    op.drop_table('user_connections')
    op.drop_table('team_messages')
    op.drop_index(op.f('ix_password_reset_tokens_token_hash'), table_name='password_reset_tokens')
    op.drop_table('password_reset_tokens')
    op.drop_index('ix_net_worth_user_date', table_name='net_worth_snapshots')
    op.drop_index(op.f('ix_net_worth_snapshots_user_id'), table_name='net_worth_snapshots')
    op.drop_index(op.f('ix_net_worth_snapshots_snapshot_date'), table_name='net_worth_snapshots')
    op.drop_table('net_worth_snapshots')
    op.drop_index('ix_meeting_attendance_timestamp', table_name='meeting_attendance_status')
    op.drop_index('ix_meeting_attendance_task', table_name='meeting_attendance_status')
    op.drop_index(op.f('ix_meeting_attendance_status_user_id'), table_name='meeting_attendance_status')
    op.drop_index(op.f('ix_meeting_attendance_status_task_id'), table_name='meeting_attendance_status')
    op.drop_table('meeting_attendance_status')
    op.drop_index(op.f('ix_hitl_actions_user_id'), table_name='hitl_actions')
    op.drop_table('hitl_actions')
    op.drop_index(op.f('ix_graph_edges_workspace_id'), table_name='graph_edges')
    op.drop_index(op.f('ix_graph_edges_target_node_id'), table_name='graph_edges')
    op.drop_index(op.f('ix_graph_edges_source_node_id'), table_name='graph_edges')
    op.drop_table('graph_edges')
    op.drop_index('ix_financial_accounts_user_type', table_name='financial_accounts')
    op.drop_index(op.f('ix_financial_accounts_user_id'), table_name='financial_accounts')
    op.drop_table('financial_accounts')
    op.drop_index('ix_email_verification_user_token', table_name='email_verification_tokens')
    op.drop_index(op.f('ix_email_verification_tokens_user_id'), table_name='email_verification_tokens')
    op.drop_index(op.f('ix_email_verification_tokens_token'), table_name='email_verification_tokens')
    op.drop_table('email_verification_tokens')
    op.drop_index('ix_custom_components_workspace_user', table_name='custom_components')
    op.drop_index(op.f('ix_custom_components_workspace_id'), table_name='custom_components')
    op.drop_index(op.f('ix_custom_components_user_id'), table_name='custom_components')
    op.drop_index(op.f('ix_custom_components_slug'), table_name='custom_components')
    op.drop_index('ix_custom_components_is_public', table_name='custom_components')
    op.drop_index('ix_custom_components_is_active', table_name='custom_components')
    op.drop_index(op.f('ix_custom_components_created_at'), table_name='custom_components')
    op.drop_index('ix_custom_components_category', table_name='custom_components')
    op.drop_table('custom_components')
    op.drop_table('community_memberships')
    op.drop_index(op.f('ix_collaboration_comments_workflow_id'), table_name='collaboration_comments')
    op.drop_index('ix_collaboration_comments_workflow', table_name='collaboration_comments')
    op.drop_index('ix_collaboration_comments_thread', table_name='collaboration_comments')
    op.drop_index('ix_collaboration_comments_resolved', table_name='collaboration_comments')
    op.drop_index(op.f('ix_collaboration_comments_parent_comment_id'), table_name='collaboration_comments')
    op.drop_index(op.f('ix_collaboration_comments_is_resolved'), table_name='collaboration_comments')
    op.drop_index(op.f('ix_collaboration_comments_created_at'), table_name='collaboration_comments')
    op.drop_index('ix_collaboration_comments_context', table_name='collaboration_comments')
    op.drop_index(op.f('ix_collaboration_comments_author_id'), table_name='collaboration_comments')
    op.drop_table('collaboration_comments')
    op.drop_index(op.f('ix_chat_processes_visibility'), table_name='chat_processes')
    op.drop_index(op.f('ix_chat_processes_team_id'), table_name='chat_processes')
    op.drop_index(op.f('ix_chat_processes_owner_id'), table_name='chat_processes')
    op.drop_table('chat_processes')
    op.drop_index(op.f('ix_agent_registry_user_id'), table_name='agent_registry')
    op.drop_table('agent_registry')
    op.drop_table('integration_metrics')
    op.drop_index(op.f('ix_ingestion_settings_workspace_id'), table_name='ingestion_settings')
    op.drop_index(op.f('ix_ingestion_settings_integration_id'), table_name='ingestion_settings')
    op.drop_table('ingestion_settings')
    op.drop_index(op.f('ix_ingested_documents_workspace_id'), table_name='ingested_documents')
    op.drop_index(op.f('ix_ingested_documents_tenant_id'), table_name='ingested_documents')
    op.drop_index(op.f('ix_ingested_documents_integration_id'), table_name='ingested_documents')
    op.drop_index(op.f('ix_ingested_documents_external_id'), table_name='ingested_documents')
    op.drop_table('ingested_documents')
    op.drop_index(op.f('ix_graph_nodes_workspace_id'), table_name='graph_nodes')
    op.drop_index(op.f('ix_graph_nodes_name'), table_name='graph_nodes')
    op.drop_table('graph_nodes')
    op.drop_index(op.f('ix_graph_communities_workspace_id'), table_name='graph_communities')
    op.drop_table('graph_communities')
    op.drop_index(op.f('ix_device_nodes_workspace_id'), table_name='device_nodes')
    op.drop_index(op.f('ix_device_nodes_user_id'), table_name='device_nodes')
    op.drop_index(op.f('ix_device_nodes_device_id'), table_name='device_nodes')
    op.drop_table('device_nodes')
    op.drop_table('business_rules')
    op.drop_index(op.f('ix_business_product_services_external_id'), table_name='business_product_services')
    op.drop_table('business_product_services')
    op.drop_index('ix_admin_users_status', table_name='admin_users')
    op.drop_index(op.f('ix_admin_users_email'), table_name='admin_users')
    op.drop_table('admin_users')
    op.drop_index(op.f('ix_tenants_subdomain'), table_name='tenants')
    op.drop_table('tenants')
    op.drop_table('integration_catalog')
    op.drop_index(op.f('ix_device_audit_workspace_id'), table_name='device_audit')
    op.drop_index(op.f('ix_device_audit_user_id'), table_name='device_audit')
    op.drop_index(op.f('ix_device_audit_session_id'), table_name='device_audit')
    op.drop_index(op.f('ix_device_audit_device_node_id'), table_name='device_audit')
    op.drop_index(op.f('ix_device_audit_created_at'), table_name='device_audit')
    op.drop_index(op.f('ix_device_audit_agent_id'), table_name='device_audit')
    op.drop_index(op.f('ix_device_audit_agent_execution_id'), table_name='device_audit')
    op.drop_table('device_audit')
    op.drop_index(op.f('ix_chat_sessions_user_id'), table_name='chat_sessions')
    op.drop_table('chat_sessions')
    op.drop_index(op.f('ix_chat_messages_workspace_id'), table_name='chat_messages')
    op.drop_index(op.f('ix_chat_messages_conversation_id'), table_name='chat_messages')
    op.drop_table('chat_messages')
    op.drop_index(op.f('ix_canvas_collaboration_sessions_user_id'), table_name='canvas_collaboration_sessions')
    op.drop_index(op.f('ix_canvas_collaboration_sessions_session_id'), table_name='canvas_collaboration_sessions')
    op.drop_index(op.f('ix_canvas_collaboration_sessions_canvas_id'), table_name='canvas_collaboration_sessions')
    op.drop_table('canvas_collaboration_sessions')
    op.drop_index(op.f('ix_canvas_audit_workspace_id'), table_name='canvas_audit')
    op.drop_index(op.f('ix_canvas_audit_user_id'), table_name='canvas_audit')
    op.drop_index(op.f('ix_canvas_audit_session_id'), table_name='canvas_audit')
    op.drop_index(op.f('ix_canvas_audit_created_at'), table_name='canvas_audit')
    op.drop_index(op.f('ix_canvas_audit_canvas_id'), table_name='canvas_audit')
    op.drop_index(op.f('ix_canvas_audit_agent_id'), table_name='canvas_audit')
    op.drop_index(op.f('ix_canvas_audit_agent_execution_id'), table_name='canvas_audit')
    op.drop_table('canvas_audit')
    op.drop_table('agent_jobs')
    op.drop_table('admin_roles')
    # ### end Alembic commands ###
