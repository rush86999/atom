---
phase: 08.5-coverage-expansion
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/tests/unit/test_enhanced_execution_state_manager.py
  - backend/tests/unit/test_unified_message_processor.py
  - backend/tests/unit/test_debug_storage.py
  - backend/tests/unit/test_cross_platform_correlation.py
autonomous: true

must_haves:
  truths:
    - "enhanced_execution_state_manager.py has baseline test coverage for state management"
    - "unified_message_processor.py has baseline test coverage for message processing"
    - "debug_storage.py has baseline test coverage for debug operations"
    - "cross_platform_correlation.py has baseline test coverage for correlation logic"
    - "All four files show >0% coverage in coverage report"
  artifacts:
    - path: "backend/tests/unit/test_enhanced_execution_state_manager.py"
      provides: "Enhanced state manager unit tests"
      min_lines: 200
    - path: "backend/tests/unit/test_unified_message_processor.py"
      provides: "Message processor unit tests"
      min_lines: 180
    - path: "backend/tests/unit/test_debug_storage.py"
      provides: "Debug storage unit tests"
      min_lines: 150
    - path: "backend/tests/unit/test_cross_platform_correlation.py"
      provides: "Cross-platform correlation unit tests"
      min_lines: 150
  key_links:
    - from: "backend/tests/unit/test_enhanced_execution_state_manager.py"
      to: "core/enhanced_execution_state_manager.py"
      via: "direct import and testing"
      pattern: "from core.enhanced_execution_state_manager import"
    - from: "backend/tests/unit/test_unified_message_processor.py"
      to: "core/unified_message_processor.py"
      via: "direct import and testing"
      pattern: "from core.unified_message_processor import"
---

<objective>
Create baseline unit tests for 4 zero-coverage infrastructure and utility files to establish measurable coverage progress.

**Purpose:** Target infrastructure/utility files (260-280 lines) that support core platform functionality with clear testing patterns.

**Output:** 4 new test files with ~680 lines total, achieving 30-50% coverage on target files.
</objective>

<execution_context>
@/Users/rushiparikh/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rushiparikh/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/08-80-percent-coverage-push/08-80-percent-coverage-push-02-SUMMARY.md
@backend/tests/unit/test_workflow_engine.py
@backend/tests/conftest.py
</context>

<tasks>

<task type="auto">
  <name>Create baseline tests for enhanced_execution_state_manager.py</name>
  <files>backend/tests/unit/test_enhanced_execution_state_manager.py</files>
  <action>
    Create test file for core/enhanced_execution_state_manager.py (286 lines):

    1. Import pattern: Follow established pattern from test_workflow_engine.py
    2. Fixtures:
       - mock_storage: AsyncMock for state persistence
       - mock_event_bus: AsyncMock for state change events
       - state_manager_instance: Direct instantiation with mocks
       - sample_execution_state: Dict with execution state structure
    3. Test classes:
       - TestStateManagerInit: Test initialization, storage backend setup
       - TestStateLifecycle: Test create_state, update_state, delete_state
       - TestStateQueries: Test get_state, query_states, filter_by_status
       - TestStateTransitions: Test status transitions (RUNNING->PAUSED->COMPLETED)
       - TestConcurrency: Test concurrent updates, lock mechanisms
    4. Test state recovery and persistence
    5. Target: ~200 lines, 15-20 tests

    Reference existing execution_state_manager patterns if available in codebase.
  </action>
  <verify>pytest backend/tests/unit/test_enhanced_execution_state_manager.py -v --cov=core/enhanced_execution_state_manager --cov-report=term-missing</verify>
  <done>Test file exists with 15+ tests, coverage shows >0% for enhanced_execution_state_manager.py</done>
</task>

<task type="auto">
  <name>Create baseline tests for unified_message_processor.py</name>
  <files>backend/tests/unit/test_unified_message_processor.py</files>
  <action>
    Create test file for core/unified_message_processor.py (272 lines):

    1. Import pattern: Follow established pattern from test_workflow_engine.py
    2. Fixtures:
       - processor_instance: Direct instantiation
       - mock_llm_handler: AsyncMock for LLM calls
       - mock_parser: AsyncMock for message parsing
       - sample_messages: List of various message types
    3. Test classes:
       - TestMessageProcessorInit: Test initialization, handler registration
       - TestMessageProcessing: Test process_message, routing, transformations
       - TestMessageTypeDetection: Test detection of intent, entities, format
       - TestErrorHandling: Test malformed messages, timeout handling
       - TestResponseGeneration: Test response formatting, templating
    4. Test different message formats (text, structured, binary)
    5. Target: ~180 lines, 12-15 tests

    Use @pytest.mark.parametrize for testing different message types.
  </action>
  <verify>pytest backend/tests/unit/test_unified_message_processor.py -v --cov=core/unified_message_processor --cov-report=term-missing</verify>
  <done>Test file exists with 12+ tests, coverage shows >0% for unified_message_processor.py</done>
</task>

<task type="auto">
  <name>Create baseline tests for debug_storage.py and cross_platform_correlation.py</name>
  <files>backend/tests/unit/test_debug_storage.py backend/tests/unit/test_cross_platform_correlation.py</files>
  <action>
    Create test files for core/debug_storage.py (271 lines) and core/cross_platform_correlation.py (265 lines):

    For test_debug_storage.py:
    1. Fixtures: mock_storage_backend, temp_debug_dir, sample_debug_data
    2. Test classes: TestDebugStorageInit, TestDebugDataStorage, TestDebugRetrieval, TestDebugPurge
    3. Test storage of execution traces, error logs, performance metrics
    4. Test data retention policies, cleanup
    5. Target: ~150 lines, 10-12 tests

    For test_cross_platform_correlation.py:
    1. Fixtures: mock_correlation_store, mock_event_tracker, correlation_config
    2. Test classes: TestCorrelationInit, TestEventCorrelation, TestCrossPlatformTracking, TestTimelineReconstruction
    3. Test correlation IDs, event chaining, platform bridging
    4. Target: ~150 lines, 10-12 tests

    Use temporary directories for file-based debug storage tests.
  </action>
  <verify>pytest backend/tests/unit/test_debug_storage.py backend/tests/unit/test_cross_platform_correlation.py -v --cov=core/debug_storage --cov=core/cross_platform_correlation --cov-report=term-missing</verify>
  <done>Both test files exist with 10+ tests each, coverage shows >0% for both files</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Run: pytest backend/tests/unit/test_enhanced_execution_state_manager.py backend/tests/unit/test_unified_message_processor.py backend/tests/unit/test_debug_storage.py backend/tests/unit/test_cross_platform_correlation.py -v
2. Verify: All 4 files show >0% coverage in: pytest --cov=core/enhanced_execution_state_manager --cov=core/unified_message_processor --cov=core/debug_storage --cov=core/cross_platform_correlation --cov-report=term-missing
3. Confirm: No import errors or test collection failures
</verification>

<success_criteria>
- 4 new test files created
- All tests pass (no failures, minimal skips)
- Each target file shows >0% coverage (baseline established)
- Overall coverage increases by measurable amount
</success_criteria>

<output>
After completion, create `.planning/phases/08.5-coverage-expansion/08.5-coverage-expansion-03-SUMMARY.md` with:
- Lines of test code added
- Coverage percentage achieved for each file
- Any patterns or issues discovered
- Next file recommendations
</output>
