---
phase: 08.5-coverage-expansion
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/tests/unit/test_enterprise_auth_service.py
  - backend/tests/unit/test_bulk_operations_processor.py
  - backend/tests/unit/test_collaboration_service.py
  - backend/tests/unit/test_agent_integration_gateway.py
autonomous: true

must_haves:
  truths:
    - "enterprise_auth_service.py has baseline test coverage for auth operations"
    - "bulk_operations_processor.py has baseline test coverage for batch processing"
    - "collaboration_service.py has baseline test coverage for collaboration features"
    - "agent_integration_gateway.py has baseline test coverage for gateway logic"
    - "All four files show >0% coverage in coverage report"
  artifacts:
    - path: "backend/tests/unit/test_enterprise_auth_service.py"
      provides: "Enterprise auth service unit tests"
      min_lines: 200
    - path: "backend/tests/unit/test_bulk_operations_processor.py"
      provides: "Bulk operations processor unit tests"
      min_lines: 200
    - path: "backend/tests/unit/test_collaboration_service.py"
      provides: "Collaboration service unit tests"
      min_lines: 180
    - path: "backend/tests/unit/test_agent_integration_gateway.py"
      provides: "Agent integration gateway unit tests"
      min_lines: 180
  key_links:
    - from: "backend/tests/unit/test_enterprise_auth_service.py"
      to: "core/enterprise_auth_service.py"
      via: "direct import and testing"
      pattern: "from core.enterprise_auth_service import"
    - from: "backend/tests/unit/test_bulk_operations_processor.py"
      to: "core/bulk_operations_processor.py"
      via: "direct import and testing"
      pattern: "from core.bulk_operations_processor import"
---

<objective>
Create baseline unit tests for 4 medium-sized zero-coverage enterprise and integration files to establish measurable coverage progress.

**Purpose:** Target medium-complexity enterprise/integration files (270-300 lines) with clear business logic for efficient baseline coverage.

**Output:** 4 new test files with ~760 lines total, achieving 30-50% coverage on target files.
</objective>

<execution_context>
@/Users/rushiparikh/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rushiparikh/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/08-80-percent-coverage-push/08-80-percent-coverage-push-08-SUMMARY.md
@backend/tests/unit/test_workflow_engine.py
@backend/tests/conftest.py
</context>

<tasks>

<task type="auto">
  <name>Create baseline tests for enterprise_auth_service.py</name>
  <files>backend/tests/unit/test_enterprise_auth_service.py</files>
  <action>
    Create test file for core/enterprise_auth_service.py (300 lines):

    1. Import pattern: Follow established pattern from test_workflow_engine.py
    2. Fixtures:
       - mock_db: AsyncMock for database sessions
       - mock_user_store: AsyncMock for user operations
       - mock_token_service: AsyncMock for JWT operations
       - mock_sso_provider: AsyncMock for SSO integration
       - enterprise_config: Dict with enterprise settings
    3. Test classes:
       - TestEnterpriseAuthInit: Test initialization with config
       - TestSSOIntegration: Test SSO login, token exchange, user provisioning
       - TestEnterprisePermissions: Test role-based access, team membership
       - TestEnterpriseValidation: Test domain validation, license checks
    4. Mock external SSO providers (Okta, Azure AD, Google Workspace)
    5. Target: ~200 lines, 15-20 tests

    Focus on auth flow validation rather than actual SSO connectivity.
  </action>
  <verify>pytest backend/tests/unit/test_enterprise_auth_service.py -v --cov=core/enterprise_auth_service --cov-report=term-missing</verify>
  <done>Test file exists with 15+ tests, coverage shows >0% for enterprise_auth_service.py</done>
</task>

<task type="auto">
  <name>Create baseline tests for bulk_operations_processor.py</name>
  <files>backend/tests/unit/test_bulk_operations_processor.py</files>
  <action>
    Create test file for core/bulk_operations_processor.py (292 lines):

    1. Import pattern: Follow established pattern from test_workflow_engine.py
    2. Fixtures:
       - processor_instance: Direct instantiation
       - mock_operation_queue: AsyncMock for queue operations
       - sample_bulk_request: Dict with bulk operation structure
       - mock_progress_tracker: AsyncMock for progress updates
    3. Test classes:
       - TestBulkProcessorInit: Test initialization, queue setup
       - TestBulkOperations: Test bulk_create, bulk_update, bulk_delete
       - TestBatchProcessing: Test batch size handling, chunking logic
       - TestErrorHandling: Test partial failures, rollback, error reporting
       - TestProgressTracking: Test status updates, completion callbacks
    4. Test batch edge cases (empty batch, single item, overflow)
    5. Target: ~200 lines, 15-20 tests

    Use @pytest.mark.parametrize for testing different batch sizes.
  </action>
  <verify>pytest backend/tests/unit/test_bulk_operations_processor.py -v --cov=core/bulk_operations_processor --cov-report=term-missing</verify>
  <done>Test file exists with 15+ tests, coverage shows >0% for bulk_operations_processor.py</done>
</task>

<task type="auto">
  <name>Create baseline tests for collaboration_service.py and agent_integration_gateway.py</name>
  <files>backend/tests/unit/test_collaboration_service.py backend/tests/unit/test_agent_integration_gateway.py</files>
  <action>
    Create test files for core/collaboration_service.py (291 lines) and core/agent_integration_gateway.py (290 lines):

    For test_collaboration_service.py:
    1. Fixtures: mock_session_store, mock_permission_manager, sample_collaboration_space
    2. Test classes: TestCollaborationInit, TestSharedWorkspaces, TestRealTimeCollaboration, TestPermissionChecks
    3. Test multi-user scenarios, conflict resolution
    4. Target: ~180 lines, 12-15 tests

    For test_agent_integration_gateway.py:
    1. Fixtures: mock_registry, mock_integration_clients, sample_gateway_config
    2. Test classes: TestGatewayInit, TestIntegrationRegistration, TestAgentRouting, TestTransformationLayer
    3. Test integration with external systems (Slack, Asana, etc.)
    4. Target: ~180 lines, 12-15 tests

    Mock external service APIs - don't make actual network calls.
  </action>
  <verify>pytest backend/tests/unit/test_collaboration_service.py backend/tests/unit/test_agent_integration_gateway.py -v --cov=core/collaboration_service --cov=core/agent_integration_gateway --cov-report=term-missing</verify>
  <done>Both test files exist with 12+ tests each, coverage shows >0% for both files</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Run: pytest backend/tests/unit/test_enterprise_auth_service.py backend/tests/unit/test_bulk_operations_processor.py backend/tests/unit/test_collaboration_service.py backend/tests/unit/test_agent_integration_gateway.py -v
2. Verify: All 4 files show >0% coverage in: pytest --cov=core/enterprise_auth_service --cov=core/bulk_operations_processor --cov=core/collaboration_service --cov=core/agent_integration_gateway --cov-report=term-missing
3. Confirm: No import errors or test collection failures
</verification>

<success_criteria>
- 4 new test files created
- All tests pass (no failures, minimal skips)
- Each target file shows >0% coverage (baseline established)
- Overall coverage increases by measurable amount
</success_criteria>

<output>
After completion, create `.planning/phases/08.5-coverage-expansion/08.5-coverage-expansion-02-SUMMARY.md` with:
- Lines of test code added
- Coverage percentage achieved for each file
- Any patterns or issues discovered
- Next file recommendations
</output>
