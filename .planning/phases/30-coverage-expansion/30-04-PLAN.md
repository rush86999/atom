---
phase: 30-coverage-expansion
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - tests/integration/test_workflow_debugger_complete.py
autonomous: true

must_haves:
  truths:
    - "workflow_debugger.py reaches 50% coverage (+202 lines from 62)"
    - "Integration tests verify complete debugging workflow lifecycle"
    - "Breakpoint management tests cover add/remove/enable/disable"
    - "Variable inspection tests cover runtime state access"
    - "All tests pass with pytest"
  artifacts:
    - path: "tests/integration/test_workflow_debugger_complete.py"
      provides: "Integration tests for workflow debugger"
      min_lines: 600
      contains: "TestWorkflowDebuggerComplete"
  key_links:
    - from: "tests/integration/test_workflow_debugger_complete.py"
      to: "core/workflow_debugger.py"
      via: "direct import of WorkflowDebugger"
      pattern: "from core.workflow_debugger import WorkflowDebugger"
    - from: "tests/integration/test_workflow_debugger_complete.py"
      to: "core.models"
      via: "database session for debug session persistence"
      pattern: "WorkflowDebugSession|WorkflowBreakpoint"
---

<objective>
Increase workflow_debugger.py test coverage from 9.7% (62/527 lines) to 50% (264+ lines) by adding comprehensive integration tests for debugging workflows.

**Purpose:** WorkflowDebugger provides step-through debugging, breakpoints, and variable inspection for workflows. Current coverage at 9.7% is the lowest of all Tier 1 files and leaves critical debugging functionality untested.

**Output:** Comprehensive integration tests (600+ lines) covering debug session lifecycle, breakpoint management, step execution control, and variable inspection.
</objective>

<execution_context>
@/Users/rushiparikh/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rushiparikh/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/30-coverage-expansion/30-coverage-expansion-PHASE.md

# Existing Test Patterns
@tests/unit/test_workflow_debugger.py
@tests/property_tests/debugger/test_workflow_debugger_invariants.py

# Source Under Test
@core/workflow_debugger.py
</context>

<tasks>

<task type="auto">
  <name>Create comprehensive debugger integration tests</name>
  <files>tests/integration/test_workflow_debugger_complete.py</files>
  <action>
    Create comprehensive integration tests for WorkflowDebugger covering all functionality:

    1. **TestWorkflowDebuggerComplete** class with integration tests:
       - **Debug Session Management**:
         - `test_create_debug_session`: Verify session creation with all parameters
         - `test_get_active_sessions`: Verify retrieval of active sessions
         - `test_pause_resume_session`: Verify session pause/resume functionality
         - `test_close_session`: Verify session cleanup and status update
       - **Breakpoint Management**:
         - `test_add_breakpoint`: Verify breakpoint added to workflow node
         - `test_remove_breakpoint`: Verify breakpoint removal
         - `test_enable_disable_breakpoint`: Verify breakpoint toggle
         - `test_conditional_breakpoint`: Verify conditional breakpoint evaluation
         - `test_breakpoint_hit_detection`: Verify execution pauses at breakpoint
       - **Step Execution Control**:
         - `test_step_over`: Verify step over executes current step and pauses
         - `test_step_into`: Verify step into enters nested workflow
         - `test_step_out`: Verify step out returns to parent workflow
         - `test_continue_execution`: Verify continue runs to next breakpoint
       - **Variable Inspection**:
         - `test_inspect_variables`: Verify variable state inspection at breakpoint
         - `test_modify_variable`: Verify runtime variable modification
         - `test_variable_watch`: Verify watch list updates on variable changes
       - **Execution Tracing**:
         - `test_record_execution_trace`: Verify trace recording
         - `test_get_trace_history`: Verify trace retrieval
         - `test_call_stack_tracking`: Verify nested workflow call stack
       - **Error Diagnostics**:
         - `test_error_breakpoint`: Verify stop_on_error functionality
         - `test_exception_breakpoint`: Verify stop_on_exceptions functionality
         - `test_error_context_capture`: Verify error context at breakpoint

    2. **Fixtures**: Use db_session for persistence, create sample workflows for debugging
    3. **Mocking**: Mock expression_evaluator, websocket_manager for isolation
    4. **Coverage Focus**: Map out uncovered lines in workflow_debugger.py and create tests for each

    Target: 600+ lines, 30+ tests, coverage reaches 50%+
  </action>
  <verify>
    Run `pytest tests/integration/test_workflow_debugger_complete.py -v --cov=core/workflow_debugger --cov-report=term-missing`
  </verify>
  <done>
    Integration tests pass, workflow_debugger.py coverage at 50%+ (264+ lines)
  </done>
</task>

</tasks>

<verification>
Overall verification steps:
1. Run `pytest tests/integration/test_workflow_debugger_complete.py tests/unit/test_workflow_debugger.py -v --cov=core/workflow_debugger --cov-report=term-missing`
2. Verify coverage >= 50% (264+ of 527 lines)
3. Verify all tests pass (100% pass rate)
4. Check coverage report for remaining gaps (document for future phases)
</verification>

<success_criteria>
1. workflow_debugger.py coverage >= 50% (264+ lines covered, up from 62)
2. All session management operations tested (create, pause, resume, close)
3. All breakpoint operations tested (add, remove, enable, disable, conditional)
4. All step control operations tested (step over, into, out, continue)
5. Variable inspection and modification tested
6. Error handling at breakpoints tested (stop_on_error, stop_on_exceptions)
</success_criteria>

<output>
After completion, create `.planning/phases/30-coverage-expansion/30-04-SUMMARY.md` with:
- Final coverage percentage for workflow_debugger.py
- Number of debugging operations tested
- Breakpoint functionality verified
- Any debugger issues found
</output>
