---
phase: 26-ci-cd-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/tests/test_feedback_enhanced.py
  - backend/tests/test_health_monitoring.py
autonomous: true
gap_closure: true

must_haves:
  truths:
    - Tests can create User objects without TypeError
    - User fixtures use correct User model schema
    - test_feedback_enhanced.py tests pass
    - test_health_monitoring.py tests pass
  artifacts:
    - path: "backend/tests/test_feedback_enhanced.py"
      provides: "Enhanced feedback system tests"
      removes: "username parameter from User fixture"
    - path: "backend/tests/test_health_monitoring.py"
      provides: "Health monitoring service tests"
      removes: "username parameter from User fixture"
  key_links:
    - from: "backend/tests/test_feedback_enhanced.py"
      to: "core/models.py:User"
      via: "User model import"
      pattern: "from core.models import User"
    - from: "backend/tests/test_health_monitoring.py"
      to: "core/models.py:User"
      via: "User model import"
      pattern: "User\\(.*email=.*\\)"
---

<objective>
Fix test fixtures that use outdated User model schema, removing the invalid 'username' parameter.

Current User model (core/models.py:194-224) has:
- id, email, password_hash, first_name, last_name, role, specialty, status, email_verified, tenant_id, skills, onboarding_completed, onboarding_step, capacity_hours, hourly_cost_rate, metadata_json, preferences

Test fixtures incorrectly use 'username' and 'full_name' fields that don't exist.
</objective>

<execution_context>
@/Users/rushiparikh/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rushiparikh/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md

# Current User Model Schema
@backend/core/models.py:194-224
</context>

<tasks>

<task type="auto">
  <name>Fix test_feedback_enhanced.py User fixture</name>
  <files>backend/tests/test_feedback_enhanced.py</files>
  <action>
    Update the test_user fixture (lines 38-53) to use correct User model fields:

    Current incorrect code:
    ```python
    user = User(
        id=f"user-{uuid.uuid4()}",
        email="test@example.com",
        username="testuser",      # REMOVE - field doesn't exist
        full_name="Test User"     # REMOVE - field doesn't exist
    )
    ```

    Change to:
    ```python
    user = User(
        id=f"user-{uuid.uuid4()}",
        email="test@example.com",
        first_name="Test",
        last_name="User"
    )
    ```

    DO NOT:
    - Add username field (doesn't exist in User model)
    - Use full_name field (doesn't exist, use first_name + last_name instead)
  </action>
  <verify>grep -n "username\|full_name" backend/tests/test_feedback_enhanced.py returns nothing</verify>
  <done>User fixture creates User objects without TypeError, using first_name/last_name instead of username/full_name</done>
</task>

<task type="auto">
  <name>Fix test_health_monitoring.py User fixture</name>
  <files>backend/tests/test_health_monitoring.py</files>
  <action>
    Update the test_user fixture (lines 47-57) to use correct User model fields.

    The current fixture only has id, email, role - which is mostly correct but may fail tests expecting first_name/last_name.

    Verify all User instantiations in this file use valid fields only:
    - Valid: id, email, password_hash, first_name, last_name, role, specialty, status, email_verified, tenant_id, skills
    - Invalid: username, full_name (remove if found)

    Run pytest on this file to confirm fixes work:
    ```
    pytest backend/tests/test_health_monitoring.py -v
    ```
  </action>
  <verify>pytest backend/tests/test_health_monitoring.py -v passes all tests</verify>
  <done>All User instantiations use valid User model fields, test suite passes</done>
</task>

</tasks>

<verification>
Run both test files to verify the User model fixes:
```bash
pytest backend/tests/test_feedback_enhanced.py -v
pytest backend/tests/test_health_monitoring.py -v
```

Expected result: Both test files pass without TypeError about 'username' keyword argument.
</verification>

<success_criteria>
- test_feedback_enhanced.py: All 11 previously failing tests now pass
- test_health_monitoring.py: All 17 previously failing tests now pass
- No TypeError: 'username' is an invalid keyword argument for User
- User fixtures use first_name/last_name instead of username/full_name
</success_criteria>

<output>
After completion, create `.planning/phases/26-ci-cd-fixes/26-01-SUMMARY.md` with:
- Tests fixed (count from each file)
- Changes made to User fixtures
- pytest output showing passing tests
</output>
