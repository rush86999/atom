---
phase: 15-codebase-completion
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/docs/DEPLOYMENT_RUNBOOK.md
  - backend/docs/OPERATIONS_GUIDE.md
  - backend/docs/TROUBLESHOOTING.md
  - .github/workflows/deploy.yml
autonomous: true

must_haves:
  truths:
    - "Deployment runbook exists with step-by-step deployment instructions"
    - "Rollback procedure documented for reverting bad deployments"
    - "Common operational issues have documented troubleshooting steps"
    - "CI/CD pipeline exists for automated deployment"
  artifacts:
    - path: "backend/docs/DEPLOYMENT_RUNBOOK.md"
      provides: "Step-by-step deployment and rollback procedures"
      contains: "## Deployment Steps"
    - path: "backend/docs/TROUBLESHOOTING.md"
      provides: "Common issues and solutions"
      contains: "## Common Issues"
  key_links:
    - from: "backend/docs/DEPLOYMENT_RUNBOOK.md"
      to: "backend/docs/TROUBLESHOOTING.md"
      via: "troubleshooting reference in rollback section"
      pattern: "See TROUBLESHOOTING.md"
    - from: ".github/workflows/deploy.yml"
      to: "backend/docs/DEPLOYMENT_RUNBOOK.md"
      via: "CI/CD deployment reference"
      pattern: "on: push: branches: \\[main\\]"
---

<objective>
Create deployment runbooks, operations guide, and troubleshooting documentation for production operations.

Purpose: Production readiness requires operational documentation for deployments, rollbacks, and incident response. Currently no deployment procedures or runbooks exist.

Output: Deployment runbook with step-by-step instructions, operations guide for common tasks, troubleshooting guide for common issues.
</objective>

<execution_context>
@/Users/rushiparikh/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rushiparikh/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/15-codebase-completion/15-RESEARCH.md
@.planning/ROADMAP.md

# Deployment patterns from Phase 13-openclaw-integration
- Docker containerization for services
- Environment variable configuration
- Health check endpoints for orchestration
- Service dependency management

# Monitoring from Plan 02
- /health/live and /health/ready endpoints
- Prometheus metrics for monitoring
- Structured logging for debugging

# Architecture from STATE.md
- FastAPI backend with SQLAlchemy
- PostgreSQL database
- Redis for WebSocket
- Docker deployment
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create deployment runbook with rollback procedures</name>
  <files>backend/docs/DEPLOYMENT_RUNBOOK.md</files>
  <action>
    1. Create backend/docs/DEPLOYMENT_RUNBOOK.md with:

    ## Pre-Deployment Checklist
    - All tests passing
    - Database migrations prepared
    - Environment variables configured
    - Backup current deployment

    ## Deployment Steps
    1. Run database migrations: `alembic upgrade head`
    2. Build Docker image: `docker build -t atom:$VERSION .`
    3. Tag and push to registry
    4. Update deployment configuration
    5. Rolling restart of services
    6. Verify health checks: `curl /health/ready`
    7. Monitor metrics: Prometheus/Grafana

    ## Rollback Procedure
    1. Identify bad version from metrics/logs
    2. Revert deployment configuration to previous version
    3. Rolling restart with previous Docker image
    4. Verify health checks return to healthy
    5. Run database rollback if needed: `alembic downgrade -1`
    6. Post-mortem: document root cause

    ## Post-Deployment Verification
    - Health checks passing
    - Error rate within baseline
    - Latency within acceptable range
    - No database connection errors

    Per 15-RESEARCH.md incident response patterns:
    - Document rollback procedures with specific commands
    - Include verification steps after each action
    - Reference monitoring endpoints for validation
  </action>
  <verify>
    Command: `grep -E "^##" backend/docs/DEPLOYMENT_RUNBOOK.md | wc -l`
    Expected: 6+ major sections (checklist, deployment, rollback, verification)
  </verify>
  <done>
    Deployment runbook created with complete deployment and rollback procedures
  </done>
</task>

<task type="auto">
  <name>Task 2: Create operations guide and troubleshooting documentation</name>
  <files>backend/docs/OPERATIONS_GUIDE.md, backend/docs/TROUBLESHOOTING.md</files>
  <action>
    1. Create backend/docs/OPERATIONS_GUIDE.md with:

    ## Daily Operations
    - Check health status: `/health/live`, `/health/ready`
    - Review error logs: structlog JSON output
    - Monitor metrics: Prometheus dashboard
    - Check agent execution rates
    - Verify database connectivity

    ## Common Tasks
    - Restarting services gracefully
    - Running database migrations
    - Checking agent status
    - Viewing skill execution logs
    - Managing user permissions

    ## Monitoring Alerts
    - High error rate (>5%)
    - Slow response times (>1s p95)
    - Database connection failures
    - Disk space low (<10% free)
    - Memory usage high (>80%)

    2. Create backend/docs/TROUBLESHOOTING.md with:

    ## Common Issues

    ### Database Connection Errors
    - Symptom: /health/ready returns 503 for database
    - Cause: Database down or network issue
    - Resolution: Check database status, verify connection string, restart services

    ### High Memory Usage
    - Symptom: Memory >80%, OOM kills
    - Cause: Memory leak, large episodic memory cache
    - Resolution: Clear cache, restart services, check episode lifecycle

    ### Slow Agent Execution
    - Symptom: Agents taking >30s to respond
    - Cause: LLM provider latency, governance cache cold
    - Resolution: Check LLM provider status, warm cache, verify BYOK configuration

    ### WebSocket Connection Failures
    - Symptom: Clients unable to connect via WebSocket
    - Cause: Redis down, WebSocket manager issue
    - Resolution: Check Redis status, verify WebSocket configuration

    ### Skill Execution Failures
    - Symptom: Skills failing with timeout or error
    - Cause: Sandbox container issue, missing dependencies
    - Resolution: Check Docker logs, verify sandbox image, reinstall dependencies

    Per 15-RESEARCH.md runbook patterns:
    - Document symptoms, causes, and resolutions
    - Include specific commands for diagnosis
    - Reference monitoring endpoints for validation
  </action>
  <verify>
    Command: `grep -c "^###" backend/docs/TROUBLESHOOTING.md`
    Expected: 5+ common issues documented
  </verify>
  <done>
    Operations guide and troubleshooting documentation created
  </done>
</task>

<task type="auto">
  <name>Task 3: Create CI/CD pipeline and SUMMARY</name>
  <files>.github/workflows/deploy.yml, .planning/phases/15-codebase-completion/15-04-SUMMARY.md</files>
  <action>
    1. Create .github/workflows/deploy.yml with:
       - Trigger on push to main branch
       - Run tests: `pytest tests/ --cov`
       - Build Docker image
       - Push to container registry
       - Deploy to staging/production (environment-specific)
       - Run health check verification
       - Notify on deployment status

    2. Include deployment jobs:
       - test: Run full test suite
       - build: Build and push Docker image
       - deploy-staging: Deploy to staging environment
       - deploy-production: Deploy to production (manual approval)
       - verify: Run health checks and smoke tests

    3. Create SUMMARY.md documenting:
       - Deployment runbook sections
       - Operations guide coverage
       - Troubleshooting issues documented
       - CI/CD pipeline created
       - Phase 15 completion status

    4. Include environment-specific configuration:
       - Staging: Automatic deployment on merge
       - Production: Manual approval required
       - Rollback: One-click rollback to previous version
  </action>
  <verify>
    Command: `grep -E "jobs:|test:|build:|deploy:" .github/workflows/deploy.yml | wc -l`
    Expected: 4+ jobs defined (test, build, deploy, verify)
  </verify>
  <done>
    CI/CD pipeline created, SUMMARY.md complete
  </done>
</task>

</tasks>

<verification>
1. Read DEPLOYMENT_RUNBOOK.md: Should have complete deployment and rollback procedures
2. Read OPERATIONS_GUIDE.md: Should cover daily operations and common tasks
3. Read TROUBLESHOOTING.md: Should have 5+ common issues with resolutions
4. Check deploy.yml: Should have test, build, deploy, verify jobs
5. Verify workflow syntax: `yamllint .github/workflows/deploy.yml` (if available)
</verification>

<success_criteria>
1. DEPLOYMENT_RUNBOOK.md has step-by-step deployment instructions with rollback
2. OPERATIONS_GUIDE.md covers daily operations and common tasks
3. TROUBLESHOOTING.md documents 5+ common issues with symptoms and resolutions
4. CI/CD pipeline exists with test, build, deploy, and verify stages
5. SUMMARY.md documents all Phase 15 deliverables
</success_criteria>

<output>
After completion, create `.planning/phases/15-codebase-completion/15-04-SUMMARY.md`
</output>
