# Plan 65-06: Menu Bar App Enhancement

---

**wave:** 2
**depends_on:** []
**files_modified:**
  - menubar/src/MenuBar.tsx
  - menubar/src/components/QuickChat.tsx
  - menubar/src/components/AgentList.tsx
  - menubar/src/components/AgentDetail.tsx
  - menubar/src/components/StatusIndicator.tsx
  - menubar/src/components/NotificationBadge.tsx
  - menubar/src/components/SettingsModal.tsx
  - menubar/src-tauri/src/commands.rs
  - menubar/src-tauri/src/notifications.rs
  - menubar/src-tauri/tauri.conf.json
**autonomous:** true

---

## Overview

Complete the menu bar app with enhanced status indicators, notification badges, comprehensive settings, and better integration with the Atom backend. The current menu bar app has basic structure with QuickChat, AgentList, and CanvasList, but needs more features and polish.

**Existing Assets:**
- Tauri 2.0 project structure
- Basic MenuBar component with QuickChat, AgentList, CanvasList
- Login screen
- Basic Rust backend with commands
- WebSocket integration

**To Be Enhanced:**
- Status indicator with health monitoring
- Notification badges for unread items
- Comprehensive settings modal
- Agent detail view
- Enhanced quick chat with history
- System-wide hotkeys
- Auto-launch on startup

---

## Tasks

### Task 01: Create Status Indicator Component

Build a comprehensive status indicator showing connection health, agent status, and system health.

**File:** `menubar/src/components/StatusIndicator.tsx`

**Requirements:**
- Connection status (connected, connecting, disconnected, error)
- Agent status (online, busy, offline)
- Latency indicator (good, degraded, poor)
- Click to view status details
- Tooltip with status information
- Animated pulse for connecting state
- Color coding (green, yellow, red)
- Status history (last 5 status changes)
- Health check button

**Acceptance Criteria:**
- [ ] Connection status displays correctly
- [ ] Agent status updates in real-time
- [ ] Latency indicator accurate
- [ ] Click opens details modal
- [ ] Tooltip shows summary
- [ ] Animations smooth
- [ ] Colors indicate severity
- [ ] History shows last 5 changes
- [ ] Health check triggers manually

---

### Task 02: Create Notification Badge Component

Build a notification badge component for unread items (messages, agent alerts, workflow updates).

**File:** `menubar/src/components/NotificationBadge.tsx`

**Requirements:**
- Badge count display
- Badge color by type (messages, alerts, updates)
- Zero state (hidden when 0)
- Max count display (99+)
- Click to view notifications
- Mark all read button
- Notification list modal
- Notification item actions (open, dismiss, snooze)
- Timestamp display
- Notification grouping

**Acceptance Criteria:**
- [ ] Count displays accurately
- [ ] Colors match notification type
- [ ] Badge hidden when count is 0
- [ ] 99+ shows for large counts
- [ ] Click opens notification list
- [ ] Mark all read works
- [ ] Notification list modal displays
- [ ] Actions function correctly
- [ ] Timestamps show relative time
- [ ] Notifications group by type

---

### Task 03: Create Settings Modal

Build a comprehensive settings modal for app configuration.

**File:** `menubar/src/components/SettingsModal.tsx`

**Requirements:**
- Server URL configuration
- Auto-launch toggle
- Start minimized toggle
- Notification preferences
- Theme selection (light, dark, auto)
- Hotkey configuration
- Agent default selection
- Clear cache button
- About section (version, license)
- Logout button
- Save/apply button

**Acceptance Criteria:**
- [ ] Server URL configures
- [ ] Auto-launch toggle works
- [ ] Start minimized functions
- [ ] Notification preferences save
- [ ] Theme selection applies
- [ ] Hotkeys can be changed
- [ ] Default agent selection persists
- [ ] Clear cache removes data
- [ ] About shows correct info
- [ ] Logout works
- [ ] Save/apply persists changes

---

### Task 04: Create Agent Detail Component

Build an agent detail view showing agent configuration, capabilities, and recent activity.

**File:** `menubar/src/components/AgentDetail.tsx`

**Requirements:**
- Agent name and description
- Maturity level badge
- Confidence score
- Capabilities list
- Recent executions (last 10)
- Execution stats (success rate, avg duration)
- Favorite toggle
- Quick chat input
- Settings button
- Episodes link (opens in browser)

**Acceptance Criteria:**
- [ ] Agent info displays
- [ ] Maturity badge shows
- [ ] Confidence score visible
- [ ] Capabilities list complete
- [ ] Recent executions show
- [ ] Stats calculate correctly
- [ ] Favorite toggle persists
- [ ] Quick chat sends message
- [ ] Settings opens configuration
- [ ] Episodes link works

---

### Task 05: Enhance Quick Chat Component

Add chat history, agent selection, and better UX to the quick chat.

**File:** `menubar/src/components/QuickChat.tsx`

**Requirements:**
- Chat history (last 20 messages)
- Agent selector dropdown
- Message input with auto-grow
- Send button with keyboard shortcut
- Streaming response display
- Typing indicator
- Clear history button
- Copy response button
- Feedback buttons (thumbs up/down)
- Auto-focus on open
- Submit with Enter (Shift+Enter for newline)

**Acceptance Criteria:**
- [ ] History loads last 20 messages
- [ ] Agent selector works
- [ ] Input grows with content
- [ ] Send button functions
- [ ] Streaming displays token-by-token
- [ ] Typing indicator shows
- [ ] Clear history removes messages
- [ ] Copy button copies response
- [ ] Feedback buttons work
- [ ] Auto-focus triggers on open
- [ ] Keyboard shortcuts work

---

### Task 06: Implement System-Wide Hotkeys

Add global hotkeys for quick access to menu bar features.

**Files:**
- `menubar/src-tauri/src/hotkeys.rs`
- `menubar/src/hooks/useHotkeys.ts`

**Requirements:**
- Toggle menu bar window (Cmd+Shift+A)
- Quick chat focus (Cmd+Shift+C)
- Show recent agents (Cmd+Shift+R)
- Show notifications (Cmd+Shift+N)
- Customizable hotkeys
- Hotkey conflict detection
- Hotkey settings in preferences

**Acceptance Criteria:**
- [ ] Toggle hotkey opens/closes window
- [ ] Quick chat hotkey focuses input
- [ ] Recent agents hotkey shows list
- [ ] Notifications hotkey shows badge
- [ ] Hotkeys can be customized
- [ ] Conflicts detected and reported
- [ ] Hotkey preferences persist

---

### Task 07: Implement Auto-Launch on Startup

Configure the menu bar app to launch automatically on system startup.

**Files:**
- `menubar/src-tauri/src/autolaunch.rs`
- `menubar/src-tauri/tauri.conf.json`

**Requirements:**
- Auto-launch enable/disable in settings
- Auto-launch respects user choice
- Launch minimized option
- Launch delay configuration
- Auto-launch status detection
- Auto-launch works on macOS and Windows

**Acceptance Criteria:**
- [ ] Auto-launch can be enabled/disabled
- [ ] Setting persists across restarts
- [ ] Launch minimized works
- [ ] Delay configures correctly
- [ ] Status detected accurately
- [ ] Works on macOS
- [ ] Works on Windows

---

### Task 08: Create Notification System (Rust Backend)

Implement a native notification system for agent alerts and system updates.

**File:** `menubar/src-tauri/src/notifications.rs`

**Requirements:**
- Native notification display
- Notification categories (agent, workflow, system)
- Notification actions (open, dismiss, snooze)
- Notification sound
- Notification persistence
- Badge count update
- Notification click handling
- Notification grouping

**Acceptance Criteria:**
- [ ] Native notifications display
- [ ] Categories work correctly
- [ ] Actions function properly
- [ ] Sound plays on notification
- [ ] Notifications persist until dismissed
- [ ] Badge count updates
- [ ] Click opens relevant screen
- [ ] Related notifications group

---

## Verification Criteria

### Functional Verification
- [ ] **V-01:** Status indicator reflects true system state
- [ ] **V-02:** Notification badges update in real-time
- [ ] **V-03:** Settings modal saves all preferences
- [ ] **V-04:** Agent detail shows complete information
- [ ] **V-05:** Quick chat sends and receives messages
- [ ] **V-06:** Hotkeys trigger correct actions
- [ ] **V-07:** Auto-launch works on system startup
- [ ] **V-08:** Native notifications display and handle actions

### UI/UX Verification
- [ ] **V-09:** Menu bar window opens quickly (<500ms)
- [ ] **V-10:** Status changes are visually obvious
- [ ] **V-11:** Quick chat feels responsive
- [ ] **V-12:** Settings are logically organized
- [ ] **V-13:** Hotkeys don't conflict with system shortcuts
- [ ] **V-14:** Notifications are non-intrusive

### Performance Verification
- [ ] **V-15:** Menu bar app uses <50MB RAM
- [ ] **V-16:** Window open animation is smooth (60fps)
- [ ] **V-17:** Status updates propagate in <100ms
- [ ] **V-18:** Quick chat response appears in <1s

---

## must_haves

### Goal-Backward Requirements (Phase 65 Success Criteria)
1. **Menu bar app functional** - All features work correctly
2. **Quick agent access** - Agents can be accessed quickly from menu bar
3. **Status indicator** - Connection and agent status visible

### Plan-Specific must_haves
1. **M-01:** StatusIndicator component with health monitoring
2. **M-02:** NotificationBadge component with unread counts
3. **M-03:** SettingsModal with all preferences
4. **M-04:** AgentDetail component
5. **M-05:** Enhanced QuickChat with history
6. **M-06:** System-wide hotkeys
7. **M-07:** Auto-launch on startup
8. **M-08:** Native notification system

---

## Success Metrics

- Menu bar app launch time: <500ms
- Status update latency: <100ms
- Quick chat response time: <1s
- Memory usage: <50MB
- Hotkey responsiveness: <50ms
- Notification delivery rate: >98%

---

## Estimated Duration

**4-5 days** (8 tasks, ~4-6 hours each)

---

## Notes

- Use Tauri API for system tray and global shortcuts
- Native notifications use macOS Notification Center and Windows Action Center
- Auto-launch uses launch agents on macOS and registry on Windows
- Hotkey conflicts should be detected and reported to user
- Consider adding Linux support in future iteration
- Status health checks should ping /health/ready endpoint
